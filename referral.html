<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BILUXE10 | PREMIUM REFERRAL</title>
    
    <!-- PREMIUM FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Clash+Display:wght@400;500;600;700&family=Satoshi:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        /* ===== ULTRA PREMIUM DESIGN SYSTEM - SAME AS AUTH ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Premium Color Palette - Luxury Edition */
            --reg: #6B7280;        /* Registration - Slate */
            --bronze: #CD7F32;     /* Bronze */
            --silver: #C0C0C0;     /* Silver */
            --gold: #FFD700;       /* Gold */
            --platinum: #E5E4E2;   /* Platinum */
            --emerald: #50C878;    /* Emerald */
            --ruby: #E0115F;       /* Ruby */
            --sapphire: #0F52BA;   /* Sapphire */
            --diamond: #B9F2FF;    /* Diamond */
            
            --primary: #0FBA7A;
            --primary-dark: #0A8C5E;
            --accent: #FFB547;
            --accent-dark: #F59E0B;
            --purple: #9D7BFF;
            --pink: #FF6B9D;
            --blue: #3B82F6;
            --red: #FF4D4D;
            
            --glass-bg: rgba(15, 25, 35, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 20px 40px -12px rgba(0,0,0,0.5);
            
            --font-display: 'Clash Display', sans-serif;
            --font-body: 'Satoshi', sans-serif;
            --font-mono: 'Space Grotesk', monospace;
        }

        body {
            font-family: var(--font-body);
            background: #05080F;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            position: relative;
            overflow-x: hidden;
        }

        /* ===== COSMIC BACKGROUND ===== */
        .cosmic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }
        
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.15;
        }
        
        .orb-1 { width: 500px; height: 500px; background: var(--primary); top: -150px; left: -150px; }
        .orb-2 { width: 450px; height: 450px; background: var(--purple); bottom: -150px; right: -150px; }
        .orb-3 { width: 400px; height: 400px; background: var(--accent); top: 50%; left: 60%; transform: translate(-50%, -50%); }
        
        .particle-grid {
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        /* ===== PREMIUM NAVBAR - SAME AS AUTH ===== */
        .premium-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(10, 15, 25, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 0.75rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .nav-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, var(--primary), #0A8C5E);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            box-shadow: 0 10px 20px rgba(15,186,122,0.3);
        }
        
        .nav-brand-text {
            font-family: var(--font-display);
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-links {
            display: flex;
            gap: 0.5rem;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            border-radius: 30px;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(15,186,122,0.15);
            color: white;
            transform: translateY(-2px);
        }
        
        .nav-link.active {
            border: 1px solid rgba(15,186,122,0.3);
            background: rgba(15,186,122,0.2);
        }
        
        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem 0.4rem 0.4rem;
            background: rgba(255,255,255,0.05);
            border-radius: 40px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            object-fit: cover;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 0.85rem;
            color: white;
        }
        
        .logout-btn {
            background: rgba(255,77,77,0.1);
            border: 1px solid rgba(255,77,77,0.2);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            color: #FF8A8A;
            font-weight: 600;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255,77,77,0.2);
            border-color: rgba(255,77,77,0.4);
            color: white;
        }

        /* ===== MOBILE MENU ===== */
        .mobile-menu-btn {
            display: none;
            background: rgba(15,186,122,0.15);
            border: 1px solid rgba(15,186,122,0.3);
            padding: 0.6rem;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
        }
        
        .mobile-menu {
            display: none;
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            background: rgba(10,15,25,0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            z-index: 999;
            padding: 1rem;
        }
        
        .mobile-menu.active { display: block; }
        
        .mobile-menu a {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem;
            color: white;
            text-decoration: none;
            border-radius: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .mobile-menu a:hover, .mobile-menu a.active {
            background: rgba(15,186,122,0.15);
        }

        /* ===== MAIN CONTAINER ===== */
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 80px auto 20px;
            padding: 0 1rem;
        }

        /* ===== PAGE HEADER ===== */
        .page-header {
            background: linear-gradient(145deg, rgba(15,186,122,0.2), rgba(157,123,255,0.2));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 32px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header-content h1 {
            font-family: var(--font-display);
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.25rem;
        }
        
        .header-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255,181,71,0.15);
            padding: 0.5rem 1rem;
            border-radius: 40px;
            border: 1px solid rgba(255,181,71,0.3);
        }

        /* ===== REFERRAL STATS GRID ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 24px;
            padding: 1.25rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(15,186,122,0.3);
            box-shadow: 0 15px 30px -10px rgba(15,186,122,0.3);
        }
        
        .stat-icon {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: rgba(255,255,255,0.6);
        }
        
        .stat-value {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .stat-sub {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.5);
            margin-top: 0.25rem;
        }

        /* ===== REFERRAL LINK SECTION ===== */
        .referral-link-card {
            background: linear-gradient(145deg, rgba(15,186,122,0.15), rgba(157,123,255,0.15));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(15,186,122,0.2);
            border-radius: 32px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .referral-link-card::before {
            content: 'üîó';
            position: absolute;
            bottom: -20px;
            right: -20px;
            font-size: 6rem;
            opacity: 0.05;
            transform: rotate(-10deg);
        }
        
        .link-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .link-icon {
            width: 45px;
            height: 45px;
            background: var(--gradient-primary);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            background: linear-gradient(145deg, var(--primary), #0A8C5E);
            color: white;
        }
        
        .link-header h3 {
            font-family: var(--font-display);
            font-weight: 700;
        }
        
        .link-container {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .link-input {
            flex: 1;
            padding: 1rem 1.2rem;
            background: rgba(255,255,255,0.05);
            border: 1.5px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            color: white;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            letter-spacing: 0.05em;
        }
        
        .link-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255,255,255,0.1);
        }
        
        .btn {
            padding: 1rem 1.8rem;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(145deg, var(--primary), #0A8C5E);
            color: white;
            box-shadow: 0 10px 20px -8px rgba(15,186,122,0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px -8px rgba(15,186,122,0.6);
        }
        
        .btn-outline {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
        }
        
        .btn-outline:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary);
        }

        /* ===== SOCIAL SHARE ===== */
        .social-share {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }
        
        .social-btn {
            padding: 0.7rem 1.2rem;
            border-radius: 30px;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .social-btn:hover {
            transform: translateY(-3px);
            filter: brightness(1.1);
        }
        
        .whatsapp { background: #25D366; }
        .facebook { background: #1877F2; }
        .telegram { background: #0088CC; }
        .twitter { background: #1DA1F2; }

        /* ===== REFERRAL LIST ===== */
        .referral-list-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 32px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .list-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        
        .list-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .list-title i {
            font-size: 1.3rem;
            color: var(--primary);
        }
        
        .filter-badge {
            display: flex;
            gap: 0.5rem;
        }
        
        .filter-pill {
            padding: 0.4rem 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 30px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-pill:hover, .filter-pill.active {
            background: rgba(15,186,122,0.15);
            border-color: rgba(15,186,122,0.3);
            color: white;
        }

        /* ===== REFERRAL ITEMS ===== */
        .referrals-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .referral-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px;
            transition: all 0.3s;
            border-left: 4px solid;
        }
        
        .referral-item:hover {
            background: rgba(255,255,255,0.05);
            transform: translateX(5px);
            border-color: rgba(15,186,122,0.2);
        }
        
        .referral-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            object-fit: cover;
        }
        
        .referral-info {
            flex: 1;
        }
        
        .referral-name {
            font-weight: 700;
            margin-bottom: 0.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .package-tag {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            border-radius: 30px;
            font-weight: 600;
        }
        
        .tier-reg { background: rgba(107,114,128,0.2); color: var(--reg); }
        .tier-bronze { background: rgba(205,127,50,0.2); color: var(--bronze); }
        .tier-silver { background: rgba(192,192,192,0.2); color: var(--silver); }
        .tier-gold { background: rgba(255,215,0,0.2); color: var(--gold); }
        .tier-platinum { background: rgba(229,228,226,0.2); color: var(--platinum); }
        .tier-emerald { background: rgba(80,200,120,0.2); color: var(--emerald); }
        .tier-ruby { background: rgba(224,17,95,0.2); color: var(--ruby); }
        .tier-sapphire { background: rgba(15,82,186,0.2); color: var(--sapphire); }
        .tier-diamond { background: rgba(185,242,255,0.2); color: var(--diamond); }
        
        .referral-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.6);
        }
        
        .referral-status {
            padding: 0.3rem 0.8rem;
            border-radius: 30px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .status-approved {
            background: rgba(15,186,122,0.15);
            color: var(--primary);
            border: 1px solid rgba(15,186,122,0.3);
        }
        
        .status-pending {
            background: rgba(255,181,71,0.15);
            color: var(--accent);
            border: 1px solid rgba(255,181,71,0.3);
        }
        
        .referral-earnings {
            font-weight: 700;
            color: var(--accent);
        }

        /* ===== LOADING & EMPTY STATES ===== */
        .empty-state {
            text-align: center;
            padding: 2.5rem;
            color: rgba(255,255,255,0.6);
        }
        
        .empty-state i {
            font-size: 3rem;
            color: rgba(255,255,255,0.1);
            margin-bottom: 1rem;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 992px) {
            .nav-links { display: none; }
            .mobile-menu-btn { display: block; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        @media (max-width: 768px) {
            .container { margin-top: 70px; }
            .stats-grid { grid-template-columns: 1fr; }
            .link-container { flex-direction: column; }
            .btn { width: 100%; }
            .referral-item { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <!-- COSMIC BACKGROUND -->
    <div class="cosmic-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="particle-grid"></div>
    </div>

    <!-- MOBILE MENU BUTTON -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
    </button>

    <!-- MOBILE MENU -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
        <a href="earnings.html"><i class="fas fa-chart-line"></i> Earnings</a>
        <a href="products.html"><i class="fas fa-cube"></i> Packages</a>
        <a href="referral.html" class="active"><i class="fas fa-users"></i> Referral</a>
        <a href="myteam.html"><i class="fas fa-network-wired"></i> My Team</a>
        <a href="withdrawal.html"><i class="fas fa-wallet"></i> Withdrawal</a>
        <a href="transactions.html"><i class="fas fa-exchange-alt"></i> Transactions</a>
        <a href="profile.html"><i class="fas fa-user"></i> Profile</a>
        <a href="support.html"><i class="fas fa-headset"></i> Support</a>
    </div>

    <!-- PREMIUM NAVBAR -->
    <nav class="premium-nav">
        <div class="nav-brand">
            <div class="nav-logo">
                <i class="fas fa-crown"></i>
            </div>
            <span class="nav-brand-text">BILUXE10</span>
        </div>

        <div class="nav-links">
            <a href="dashboard.html" class="nav-link"><i class="fas fa-home"></i> Dashboard</a>
            <a href="earnings.html" class="nav-link"><i class="fas fa-chart-line"></i> Earnings</a>
            <a href="products.html" class="nav-link"><i class="fas fa-cube"></i> Packages</a>
            <a href="referral.html" class="nav-link active"><i class="fas fa-users"></i> Referral</a>
            <a href="myteam.html" class="nav-link"><i class="fas fa-network-wired"></i> My Team</a>
            <a href="withdrawal.html" class="nav-link"><i class="fas fa-wallet"></i> Withdrawal</a>
        </div>

        <div class="nav-user">
            <div class="user-profile" onclick="window.location.href='profile.html'">
                <img id="headerAvatar" src="https://ui-avatars.com/api/?name=User&background=0FBA7A&color=fff&size=64" alt="Profile" class="user-avatar">
                <span id="headerUserName" class="user-name">Loading...</span>
            </div>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- PAGE HEADER -->
        <div class="page-header">
            <div class="header-content">
                <h1><i class="fas fa-users"></i> Referral Program</h1>
                <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Invite friends & earn 50% commission + bonus</p>
            </div>
            <div class="header-badge">
                <i class="fas fa-gift" style="color: var(--accent);"></i>
                <span>‚Çπ100 Welcome Bonus for referrals</span>
            </div>
        </div>

        <!-- REFERRAL STATS -->
        <div class="stats-grid" id="statsContainer">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-user-plus"></i></div>
                <div class="stat-label">TOTAL REFERRALS</div>
                <div class="stat-value" id="totalReferrals">0</div>
                <div class="stat-sub">All joined members</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                <div class="stat-label">APPROVED TEAM</div>
                <div class="stat-value" id="approvedReferrals">0</div>
                <div class="stat-sub">Payment completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-rupee-sign"></i></div>
                <div class="stat-label">REFERRAL EARNINGS</div>
                <div class="stat-value" id="referralEarnings">‚Çπ0</div>
                <div class="stat-sub">Lifetime commission</div>
            </div>
        </div>

        <!-- REFERRAL LINK SECTION -->
        <div class="referral-link-card">
            <div class="link-header">
                <div class="link-icon">
                    <i class="fas fa-link"></i>
                </div>
                <h3>Your Unique Referral Link</h3>
            </div>
            
            <div class="link-container">
                <input type="text" id="referralLinkInput" class="link-input" readonly value="Loading your referral link...">
                <button class="btn btn-primary" onclick="copyReferralLink()">
                    <i class="fas fa-copy"></i> Copy
                </button>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <span style="background: rgba(255,181,71,0.15); padding: 0.3rem 0.8rem; border-radius: 30px; font-size: 0.75rem; border: 1px solid rgba(255,181,71,0.3);">
                    <i class="fas fa-tag" style="color: var(--accent);"></i> Referral Code: <strong id="referralCodeDisplay">BLX10XXXXXX</strong>
                </span>
            </div>
            
            <div class="social-share">
                <button class="social-btn whatsapp" onclick="shareWhatsApp()">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </button>
                <button class="social-btn facebook" onclick="shareFacebook()">
                    <i class="fab fa-facebook"></i> Facebook
                </button>
                <button class="social-btn telegram" onclick="shareTelegram()">
                    <i class="fab fa-telegram"></i> Telegram
                </button>
                <button class="social-btn twitter" onclick="shareTwitter()">
                    <i class="fab fa-twitter"></i> Twitter
                </button>
                <button class="btn-outline" style="padding: 0.7rem 1.2rem;" onclick="copyReferralCode()">
                    <i class="fas fa-copy"></i> Copy Code
                </button>
            </div>
        </div>

        <!-- REFERRAL LIST -->
        <div class="referral-list-card">
            <div class="list-header">
                <div class="list-title">
                    <i class="fas fa-list"></i>
                    <h3>Your Referrals</h3>
                </div>
                <div class="filter-badge">
                    <span class="filter-pill active" onclick="filterReferrals('all', this)">All</span>
                    <span class="filter-pill" onclick="filterReferrals('approved', this)">Approved</span>
                    <span class="filter-pill" onclick="filterReferrals('pending', this)">Pending</span>
                </div>
            </div>
            
            <div id="referralsList" class="referrals-container">
                <div class="loading-spinner"></div>
                <p style="text-align: center; color: rgba(255,255,255,0.6);">Loading your referrals...</p>
            </div>
        </div>

        <!-- COMMISSION STRUCTURE -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
            <div style="background: rgba(15,186,122,0.08); border-radius: 20px; padding: 1.25rem; border-left: 4px solid var(--primary);">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                    <div style="background: rgba(15,186,122,0.15); width: 35px; height: 35px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user-check" style="color: var(--primary);"></i>
                    </div>
                    <h4 style="font-weight: 700;">50% Direct Commission</h4>
                </div>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">Earn 50% commission when your referral buys any package</p>
            </div>
            
            <div style="background: rgba(255,181,71,0.08); border-radius: 20px; padding: 1.25rem; border-left: 4px solid var(--accent);">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                    <div style="background: rgba(255,181,71,0.15); width: 35px; height: 35px; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-gift" style="color: var(--accent);"></i>
                    </div>
                    <h4 style="font-weight: 700;">‚Çπ100 Welcome Bonus</h4>
                </div>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.7);">Your referrals get ‚Çπ100 bonus on joining</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // üî• FIREBASE CONFIGURATION - SAME AS AUTH
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyDxxkC9iD1V1w-53Kf4oBrHEXlBLvCc7sE",
            authDomain: "biluxe10-3e894.firebaseapp.com",
            projectId: "biluxe10-3e894",
            storageBucket: "biluxe10-3e894.firebasestorage.app",
            messagingSenderId: "804749588233",
            appId: "1:804749588233:web:7777648c0c7834733c05d8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ============================================
        // üî• GLOBAL VARIABLES
        // ============================================
        let currentUser = null;
        let currentEmailId = null;
        let currentReferralCode = null;
        let allReferrals = [];
        let currentFilter = 'all';
        
        // Package colors for tier display
        const PACKAGE_TIERS = {
            'REGISTRATION': 'tier-reg',
            'BRONZE': 'tier-bronze',
            'SILVER': 'tier-silver',
            'GOLD': 'tier-gold',
            'PLATINUM': 'tier-platinum',
            'EMERALD': 'tier-emerald',
            'RUBY': 'tier-ruby',
            'SAPPHIRE': 'tier-sapphire',
            'DIAMOND': 'tier-diamond'
        };

        // ============================================
        // üî• HELPER: Get sanitized email ID (SAME AS AUTH)
        // ============================================
        function getEmailId(email) {
            return email.toLowerCase().replace(/\./g, '_');
        }

        // ============================================
        // üî• MOBILE MENU TOGGLE
        // ============================================
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            document.getElementById('mobileMenu').classList.toggle('active');
        });

        // ============================================
        // üî• AUTH STATE - MUST BE LOGGED IN
        // ============================================
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                currentEmailId = getEmailId(user.email);
                console.log('‚úÖ Logged in:', currentEmailId);
                await loadUserData();
                await loadReferrals();
            } else {
                window.location.href = 'auth.html';
            }
        });

        // ============================================
        // üî• LOAD USER DATA - GET REFERRAL CODE
        // ============================================
        async function loadUserData() {
            try {
                const userDoc = await db.collection('user_collections').doc(currentEmailId).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    currentReferralCode = userData.referralCode;
                    
                    // Update UI
                    document.getElementById('headerUserName').textContent = userData.fullName || userData.username || 'User';
                    document.getElementById('referralCodeDisplay').textContent = currentReferralCode;
                    
                    // Update referral link
                    const referralLink = `${window.location.origin}/auth.html?ref=${currentReferralCode}`;
                    document.getElementById('referralLinkInput').value = referralLink;
                    
                    // Update stats
                    document.getElementById('totalReferrals').textContent = userData.referralCount || 0;
                    document.getElementById('referralEarnings').textContent = '‚Çπ' + (userData.referralEarnings || 0).toFixed(2);
                    
                    // Get approved count separately
                    await updateApprovedCount();
                    
                    // Update avatar
                    if (userData.profilePicture) {
                        document.getElementById('headerAvatar').src = userData.profilePicture;
                    } else {
                        const name = userData.fullName || userData.username || 'User';
                        document.getElementById('headerAvatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0FBA7A&color=fff&size=64`;
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // ============================================
        // üî• UPDATE APPROVED REFERRALS COUNT (TEAM)
        // ============================================
        async function updateApprovedCount() {
            try {
                const snapshot = await db.collection('user_collections')
                    .where('referredBy', '==', currentEmailId)
                    .where('paymentStatus', '==', 'approved')
                    .get();
                
                document.getElementById('approvedReferrals').textContent = snapshot.size;
            } catch (error) {
                console.error('Error counting approved referrals:', error);
            }
        }

        // ============================================
        // üî• LOAD REFERRALS - WITH PAYMENT STATUS
        // ============================================
        async function loadReferrals() {
            try {
                const snapshot = await db.collection('user_collections')
                    .where('referredBy', '==', currentEmailId)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                allReferrals = [];
                
                snapshot.forEach(doc => {
                    const referral = doc.data();
                    referral.id = doc.id;
                    
                    // Format date
                    if (referral.createdAt && referral.createdAt.toDate) {
                        referral.joinDate = referral.createdAt.toDate();
                    } else {
                        referral.joinDate = new Date();
                    }
                    
                    allReferrals.push(referral);
                });
                
                filterReferrals('all', document.querySelector('.filter-pill.active'));
                
            } catch (error) {
                console.error('Error loading referrals:', error);
                document.getElementById('referralsList').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle" style="color: var(--red);"></i>
                        <h4 style="color: white;">Error Loading Referrals</h4>
                        <p>Please refresh the page</p>
                    </div>
                `;
            }
        }

        // ============================================
        // üî• FILTER REFERRALS (ALL, APPROVED, PENDING)
        // ============================================
        window.filterReferrals = function(filter, element) {
            currentFilter = filter;
            
            // Update active filter
            document.querySelectorAll('.filter-pill').forEach(el => {
                el.classList.remove('active');
            });
            element.classList.add('active');
            
            let filtered = [];
            
            if (filter === 'all') {
                filtered = allReferrals;
            } else if (filter === 'approved') {
                filtered = allReferrals.filter(ref => ref.paymentStatus === 'approved');
            } else if (filter === 'pending') {
                filtered = allReferrals.filter(ref => ref.paymentStatus === 'pending' || !ref.paymentStatus);
            }
            
            displayReferrals(filtered);
        };

        // ============================================
        // üî• DISPLAY REFERRALS
        // ============================================
        function displayReferrals(referrals) {
            const container = document.getElementById('referralsList');
            
            if (referrals.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h4 style="color: white;">No Referrals Yet</h4>
                        <p>Share your referral link to start earning!</p>
                        <button class="btn btn-primary" style="margin-top: 1rem; display: inline-flex; width: auto;" onclick="copyReferralLink()">
                            <i class="fas fa-copy"></i> Copy Referral Link
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            referrals.forEach(ref => {
                const joinDate = ref.joinDate.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                
                const status = ref.paymentStatus === 'approved' ? 'approved' : 'pending';
                const statusText = ref.paymentStatus === 'approved' ? '‚úì Approved' : '‚è≥ Pending';
                const packageName = ref.selectedPackage || 'REGISTRATION';
                const tierClass = PACKAGE_TIERS[packageName] || 'tier-reg';
                
                // Calculate estimated earnings (50% of package amount)
                const estimatedEarnings = ref.paymentStatus === 'approved' ? (ref.packageAmount || 0) * 0.5 : 0;
                
                html += `
                    <div class="referral-item" style="border-left-color: ${ref.paymentStatus === 'approved' ? 'var(--primary)' : 'var(--accent)'};">
                        <img src="${ref.profilePicture || `https://ui-avatars.com/api/?name=${encodeURIComponent(ref.fullName || ref.username || 'User')}&background=0FBA7A&color=fff&size=64`}" 
                             alt="${ref.fullName}" class="referral-avatar">
                        <div class="referral-info">
                            <div class="referral-name">
                                ${ref.fullName || ref.username || 'User'}
                                <span class="package-tag ${tierClass}">${packageName}</span>
                            </div>
                            <div class="referral-meta">
                                <span><i class="fas fa-calendar"></i> ${joinDate}</span>
                                <span><i class="fas fa-rupee-sign"></i> Package: ‚Çπ${(ref.packageAmount || 0).toLocaleString()}</span>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.3rem;">
                            <span class="referral-status status-${status}">${statusText}</span>
                            ${ref.paymentStatus === 'approved' ? 
                                `<span class="referral-earnings">+‚Çπ${estimatedEarnings.toFixed(2)} earned</span>` : 
                                `<span style="font-size: 0.7rem; color: rgba(255,255,255,0.5);">Commission pending</span>`
                            }
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ============================================
        // üî• COPY REFERRAL LINK
        // ============================================
        window.copyReferralLink = function() {
            const input = document.getElementById('referralLinkInput');
            input.select();
            navigator.clipboard.writeText(input.value).then(() => {
                showToast('‚úÖ Referral link copied!', 'success');
            }).catch(() => {
                alert('Link copied to clipboard!');
            });
        };

        // ============================================
        // üî• COPY REFERRAL CODE
        // ============================================
        window.copyReferralCode = function() {
            const code = document.getElementById('referralCodeDisplay').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showToast('‚úÖ Referral code copied!', 'success');
            });
        };

        // ============================================
        // üî• SHARE FUNCTIONS
        // ============================================
        window.shareWhatsApp = function() {
            const link = document.getElementById('referralLinkInput').value;
            const message = `üöÄ Join BILUXE10 Premium Affiliate and start earning!\n\nUse my referral link: ${link}\n\n‚úÖ 50% Commission\n‚úÖ Welcome Bonus\n‚úÖ Passive Income`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        };
        
        window.shareFacebook = function() {
            const link = document.getElementById('referralLinkInput').value;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(link)}`, '_blank');
        };
        
        window.shareTelegram = function() {
            const link = document.getElementById('referralLinkInput').value;
            const message = `Join BILUXE10 Premium Affiliate - ${link}`;
            window.open(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(message)}`, '_blank');
        };
        
        window.shareTwitter = function() {
            const link = document.getElementById('referralLinkInput').value;
            const text = `Join me on BILUXE10 Premium Affiliate and start earning! üöÄüí∞`;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(link)}`, '_blank');
        };

        // ============================================
        // üî• TOAST NOTIFICATION
        // ============================================
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: ${type === 'success' ? 'rgba(15,186,122,0.9)' : 'rgba(255,77,77,0.9)'};
                color: white;
                padding: 0.8rem 1.5rem;
                border-radius: 30px;
                font-weight: 600;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255,255,255,0.2);
                z-index: 9999;
                animation: slideIn 0.3s ease;
            `;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ============================================
        // üî• LOGOUT
        // ============================================
        window.logout = function() {
            auth.signOut().then(() => {
                window.location.href = 'auth.html';
            }).catch(console.error);
        };

        // ============================================
        // üî• ADD STYLES FOR TOAST
        // ============================================
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        console.log('‚úÖ REFERRAL PAGE - EMAIL-ID SYSTEM - TEAM COUNT FIXED');
    </script>
</body>
</html>
