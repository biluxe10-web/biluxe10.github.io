<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biluxe10 - Packages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .page-transition { animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .package-card { transition: all 0.3s ease; }
        .package-card:hover { transform: translateY(-10px); }
        .popular-badge { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .current-plan { border: 3px solid #10b981; box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
        .feature-list li { transition: all 0.3s ease; }
        .feature-list li:hover { transform: translateX(5px); color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation Sidebar (Same as dashboard) -->
    <div class="sidebar fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-gray-900 to-black text-white shadow-xl z-50">
        <!-- Same sidebar code -->
    </div>

    <!-- Main Content -->
    <div class="ml-64 min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between h-16 px-8">
                <div>
                    <h2 class="text-xl font-semibold text-gray-900">Membership Packages</h2>
                    <p class="text-sm text-gray-600">Upgrade your plan to unlock more features</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="window.location.href='notifications.html'" class="p-2 text-gray-600 hover:text-gray-900 relative">
                        <i class="fas fa-bell text-xl"></i>
                        <span id="notificationBadge" class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full hidden"></span>
                    </button>
                    <div class="flex items-center space-x-3 bg-gray-50 rounded-lg px-3 py-2 cursor-pointer" onclick="window.location.href='profile.html'">
                        <img id="headerProfilePic" src="https://via.placeholder.com/32" alt="Profile" class="w-8 h-8 rounded-full border-2 border-blue-500">
                        <span id="headerUserName" class="text-sm font-medium text-gray-900">User</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Packages Content -->
        <main class="p-6 page-transition">
            <!-- Current Plan Banner -->
            <div id="currentPlanBanner" class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-6 text-white mb-8">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                        <h3 class="text-xl font-semibold mb-2">Your Current Plan</h3>
                        <p class="text-green-100" id="currentPlanText">You are on the <strong>Starter</strong> package</p>
                        <p class="text-green-100 text-sm mt-1">Total Earnings: <strong id="totalEarnings">₹0</strong></p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="text-4xl">⭐</div>
                        <div class="text-right">
                            <div class="text-sm opacity-90">Active Since</div>
                            <div class="font-semibold" id="memberSince">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Packages Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-8">
                <!-- Starter Package -->
                <div class="package-card bg-white rounded-2xl shadow-lg border-2 border-gray-200 overflow-hidden">
                    <div class="p-6 bg-gradient-to-r from-gray-600 to-gray-700 text-white">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl font-bold">Starter</h3>
                                <div class="mt-2">
                                    <span class="text-3xl font-bold">₹999</span>
                                    <span class="text-gray-300 ml-2">one-time</span>
                                </div>
                            </div>
                            <div id="starterBadge" class="hidden">
                                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                    Current
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <ul class="feature-list space-y-3 mb-6">
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                50% Direct Commission
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                10% Passive Income
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                5% Ads Bonus
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Basic Support
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Referral System Access
                            </li>
                        </ul>

                        <button class="w-full py-3 px-4 rounded-lg font-semibold border-2 border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors" 
                                data-package="Starter" data-price="999" onclick="selectPackage(this)">
                            Select Package
                        </button>
                    </div>
                </div>

                <!-- Bronze Package -->
                <div class="package-card bg-white rounded-2xl shadow-lg border-2 border-amber-500 overflow-hidden">
                    <div class="p-6 bg-gradient-to-r from-amber-600 to-amber-700 text-white">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl font-bold">Bronze</h3>
                                <div class="mt-2">
                                    <span class="text-3xl font-bold">₹2,499</span>
                                    <span class="text-amber-300 ml-2">one-time</span>
                                </div>
                            </div>
                            <div id="bronzeBadge" class="hidden">
                                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                    Current
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <ul class="feature-list space-y-3 mb-6">
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                50% Direct Commission
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                10% Passive Income
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                5% Ads Bonus
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Priority Support
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Advanced Tools
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Weekly Training
                            </li>
                        </ul>

                        <button class="w-full py-3 px-4 rounded-lg font-semibold bg-amber-500 text-white hover:bg-amber-600 transition-colors" 
                                data-package="Bronze" data-price="2499" onclick="selectPackage(this)">
                            Select Package
                        </button>
                    </div>
                </div>

                <!-- Silver Package (Most Popular) -->
                <div class="package-card bg-white rounded-2xl shadow-xl border-2 border-gray-400 overflow-hidden relative">
                    <div class="popular-badge bg-yellow-500 text-white text-center py-2 text-sm font-semibold">
                        ⭐ MOST POPULAR
                    </div>
                    <div class="p-6 bg-gradient-to-r from-gray-400 to-gray-500 text-white">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl font-bold">Silver</h3>
                                <div class="mt-2">
                                    <span class="text-3xl font-bold">₹3,499</span>
                                    <span class="text-gray-300 ml-2">one-time</span>
                                </div>
                            </div>
                            <div id="silverBadge" class="hidden">
                                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                    Current
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <ul class="feature-list space-y-3 mb-6">
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                50% Direct Commission
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                10% Passive Income
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                5% Ads Bonus
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Priority Support
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Advanced Tools
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Weekly Training
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Marketing Materials
                            </li>
                        </ul>

                        <button class="w-full py-3 px-4 rounded-lg font-semibold bg-gray-600 text-white hover:bg-gray-700 transition-colors" 
                                data-package="Silver" data-price="3499" onclick="selectPackage(this)">
                            Select Package
                        </button>
                    </div>
                </div>

                <!-- Gold Package -->
                <div class="package-card bg-white rounded-2xl shadow-lg border-2 border-yellow-500 overflow-hidden">
                    <div class="p-6 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl font-bold">Gold</h3>
                                <div class="mt-2">
                                    <span class="text-3xl font-bold">₹4,999</span>
                                    <span class="text-yellow-300 ml-2">one-time</span>
                                </div>
                            </div>
                            <div id="goldBadge" class="hidden">
                                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                    Current
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <ul class="feature-list space-y-3 mb-6">
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                50% Direct Commission
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                10% Passive Income
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                5% Ads Bonus
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                24/7 Support
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                All Tools Access
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Weekly Training
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Marketing Materials
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Business Kit
                            </li>
                        </ul>

                        <button class="w-full py-3 px-4 rounded-lg font-semibold bg-yellow-500 text-white hover:bg-yellow-600 transition-colors" 
                                data-package="Gold" data-price="4999" onclick="selectPackage(this)">
                            Select Package
                        </button>
                    </div>
                </div>

                <!-- Platinum Package -->
                <div class="package-card bg-white rounded-2xl shadow-lg border-2 border-teal-500 overflow-hidden">
                    <div class="p-6 bg-gradient-to-r from-teal-500 to-teal-600 text-white">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl font-bold">Platinum</h3>
                                <div class="mt-2">
                                    <span class="text-3xl font-bold">₹9,999</span>
                                    <span class="text-teal-300 ml-2">one-time</span>
                                </div>
                            </div>
                            <div id="platinumBadge" class="hidden">
                                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                    Current
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <ul class="feature-list space-y-3 mb-6">
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                50% Direct Commission
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                10% Passive Income
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                5% Ads Bonus
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                24/7 VIP Support
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                All Tools Access
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Daily Training
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Marketing Materials
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Business Kit
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Mentorship Program
                            </li>
                        </ul>

                        <button class="w-full py-3 px-4 rounded-lg font-semibold bg-teal-500 text-white hover:bg-teal-600 transition-colors" 
                                data-package="Platinum" data-price="9999" onclick="selectPackage(this)">
                            Select Package
                        </button>
                    </div>
                </div>

                <!-- Diamond Package -->
                <div class="package-card bg-white rounded-2xl shadow-lg border-2 border-blue-500 overflow-hidden">
                    <div class="p-6 bg-gradient-to-r from-blue-500 to-blue-600 text-white">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl font-bold">Diamond</h3>
                                <div class="mt-2">
                                    <span class="text-3xl font-bold">₹14,999</span>
                                    <span class="text-blue-300 ml-2">one-time</span>
                                </div>
                            </div>
                            <div id="diamondBadge" class="hidden">
                                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                    Current
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <ul class="feature-list space-y-3 mb-6">
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                50% Direct Commission
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                10% Passive Income
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                5% Ads Bonus
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                24/7 VIP Support
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                All Tools Access
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Daily Training
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Marketing Materials
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Business Kit
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Mentorship Program
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Leadership Training
                            </li>
                        </ul>

                        <button class="w-full py-3 px-4 rounded-lg font-semibold bg-blue-500 text-white hover:bg-blue-600 transition-colors" 
                                data-package="Diamond" data-price="14999" onclick="selectPackage(this)">
                            Select Package
                        </button>
                    </div>
                </div>

                <!-- Elite Package -->
                <div class="package-card bg-white rounded-2xl shadow-lg border-2 border-purple-500 overflow-hidden">
                    <div class="p-6 bg-gradient-to-r from-purple-600 to-purple-700 text-white">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-xl font-bold">Elite</h3>
                                <div class="mt-2">
                                    <span class="text-3xl font-bold">₹23,999</span>
                                    <span class="text-purple-300 ml-2">one-time</span>
                                </div>
                            </div>
                            <div id="eliteBadge" class="hidden">
                                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                    Current
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="p-6">
                        <ul class="feature-list space-y-3 mb-6">
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                50% Direct Commission
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                10% Passive Income
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                5% Ads Bonus
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                24/7 VIP Support
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                All Tools Access
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                1-on-1 Training
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Marketing Materials
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Business Kit
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Mentorship Program
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Leadership Training
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                                Leadership Bonus
                            </li>
                        </ul>

                        <button class="w-full py-3 px-4 rounded-lg font-semibold bg-purple-600 text-white hover:bg-purple-700 transition-colors" 
                                data-package="Elite" data-price="23999" onclick="selectPackage(this)">
                            Select Package
                        </button>
                    </div>
                </div>
            </div>

            <!-- Purchase Modal -->
            <div id="purchaseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
                <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                    <h3 class="text-xl font-bold text-gray-900 mb-4" id="modalTitle">Confirm Package Purchase</h3>
                    
                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900" id="modalPackageName">Package Name</div>
                            <div class="text-3xl font-bold text-indigo-600 my-2">₹<span id="modalPackagePrice">0</span></div>
                            <p class="text-sm text-gray-600">One-time payment</p>
                        </div>
                    </div>

                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Current Balance:</span>
                            <span class="font-semibold">₹<span id="modalCurrentBalance">0</span></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Package Price:</span>
                            <span class="font-semibold">₹<span id="modalPackageAmount">0</span></span>
                        </div>
                        <div class="border-t pt-2">
                            <div class="flex justify-between font-semibold">
                                <span>Amount Due:</span>
                                <span class="text-red-600">₹<span id="modalAmountDue">0</span></span>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-3">
                        <button onclick="closeModal()" class="flex-1 py-3 px-4 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button id="confirmPurchaseBtn" onclick="processPurchase()" 
                                class="flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                            Confirm Purchase
                        </button>
                    </div>

                    <p id="modalError" class="text-red-600 text-sm text-center mt-3 hidden">
                        Insufficient balance. Please add funds to your account.
                    </p>
                </div>
            </div>

            <!-- Commission Info -->
            <div class="bg-blue-50 border border-blue-200 rounded-2xl p-6">
                <h3 class="text-lg font-semibold text-blue-800 mb-2">💰 Commission Information</h3>
                <p class="text-blue-700">
                    When someone purchases any package through your referral, you earn:
                </p>
                <ul class="text-blue-700 text-sm mt-2 space-y-1">
                    <li>• <strong>50% Direct Commission</strong> - When your direct referral buys any package</li>
                    <li>• <strong>10% Passive Income</strong> - When your Level 2 referrals make purchases</li>
                    <li>• <strong>5% Ads Bonus</strong> - When your Level 3 network grows</li>
                </ul>
                <p class="text-blue-800 font-semibold mt-3">
                    Total Potential Commission: <strong>65%</strong> on every sale in your network!
                </p>
            </div>
        </main>
    </div>

    <!-- Firebase & Packages Script -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDxxkC9iD1V1w-53Kf4oBrHEXlBLvCc7sE",
            authDomain: "biluxe10-3e894.firebaseapp.com",
            projectId: "biluxe10-3e894",
            storageBucket: "biluxe10-3e894.firebasestorage.app",
            messagingSenderId: "804749588233",
            appId: "1:804749588233:web:7777648c0c7834733c05d8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let currentUser = null;
        let userData = null;
        let selectedPackage = null;

        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
        });

        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loadUserData(user.uid);
                    loadNotifications(user.uid);
                } else {
                    window.location.href = 'auth.html';
                }
            });
        }

        function loadUserData(userId) {
            db.collection('users').doc(userId).onSnapshot((doc) => {
                if (doc.exists) {
                    userData = doc.data();
                    updateUserUI(userData);
                    updateCurrentPlan();
                }
            });
        }

        function updateCurrentPlan() {
            if (!userData) return;

            const currentPlan = userData.membership || 'Starter';
            document.getElementById('currentPlanText').innerHTML = `You are on the <strong>${currentPlan}</strong> package`;
            
            // Calculate total earnings from transactions
            calculateTotalEarnings();
            
            document.getElementById('memberSince').textContent = userData.joinDate?.toDate ? 
                userData.joinDate.toDate().toLocaleDateString('en-IN') : 'Recent';

            // Update current plan badges
            const badges = ['starterBadge', 'bronzeBadge', 'silverBadge', 'goldBadge', 'platinumBadge', 'diamondBadge', 'eliteBadge'];
            badges.forEach(badge => document.getElementById(badge).classList.add('hidden'));
            
            const currentBadge = `${currentPlan.toLowerCase()}Badge`;
            if (document.getElementById(currentBadge)) {
                document.getElementById(currentBadge).classList.remove('hidden');
            }

            // Update button texts for current plan
            const buttons = document.querySelectorAll(`[data-package="${currentPlan}"]`);
            buttons.forEach(button => {
                button.textContent = 'Current Plan';
                button.disabled = true;
                button.classList.remove('bg-blue-500', 'bg-amber-500', 'bg-gray-600', 'bg-yellow-500', 'bg-teal-500', 'bg-blue-500', 'bg-purple-600');
                button.classList.add('bg-green-500', 'hover:bg-green-600', 'cursor-not-allowed');
            });
        }

        async function calculateTotalEarnings() {
            if (!currentUser) return;
            
            try {
                const snapshot = await db.collection('transactions')
                    .where('userId', '==', currentUser.uid)
                    .where('type', 'in', ['earning', 'bonus'])
                    .get();
                
                let totalEarnings = 0;
                snapshot.forEach(doc => {
                    totalEarnings += doc.data().amount;
                });
                
                document.getElementById('totalEarnings').textContent = totalEarnings.toLocaleString();
            } catch (error) {
                console.error('Error calculating earnings:', error);
            }
        }

        function selectPackage(button) {
            const packageName = button.getAttribute('data-package');
            const packagePrice = parseInt(button.getAttribute('data-price'));

            // Don't allow selecting current package
            if (userData && userData.membership === packageName) {
                showToast('You are already on this package!', 'info');
                return;
            }

            // Check if user is downgrading (not allowed)
            const currentPackageRank = getPackageRank(userData?.membership);
            const selectedPackageRank = getPackageRank(packageName);
            
            if (selectedPackageRank < currentPackageRank) {
                showToast('You cannot downgrade your package. Please contact support.', 'error');
                return;
            }

            selectedPackage = { name: packageName, price: packagePrice };
            openModal();
        }

        function getPackageRank(packageName) {
            const ranks = {
                'Starter': 1,
                'Bronze': 2,
                'Silver': 3,
                'Gold': 4,
                'Platinum': 5,
                'Diamond': 6,
                'Elite': 7
            };
            return ranks[packageName] || 0;
        }

        function openModal() {
            if (!selectedPackage || !userData) return;

            document.getElementById('modalPackageName').textContent = selectedPackage.name;
            document.getElementById('modalPackagePrice').textContent = selectedPackage.price.toLocaleString();
            document.getElementById('modalPackageAmount').textContent = selectedPackage.price.toLocaleString();
            document.getElementById('modalCurrentBalance').textContent = (userData.balance || 0).toLocaleString();
            document.getElementById('modalAmountDue').textContent = selectedPackage.price.toLocaleString();

            // Check if user has sufficient balance
            const hasSufficientBalance = (userData.balance || 0) >= selectedPackage.price;
            document.getElementById('confirmPurchaseBtn').disabled = !hasSufficientBalance;
            document.getElementById('modalError').classList.toggle('hidden', hasSufficientBalance);

            document.getElementById('purchaseModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('purchaseModal').classList.add('hidden');
            selectedPackage = null;
        }

        async function processPurchase() {
            if (!selectedPackage || !userData || !currentUser) return;

            const confirmBtn = document.getElementById('confirmPurchaseBtn');
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';

            try {
                // Check balance again
                if ((userData.balance || 0) < selectedPackage.price) {
                    throw new Error('Insufficient balance');
                }

                const batch = db.batch();

                // 1. Update user membership
                const userRef = db.collection('users').doc(currentUser.uid);
                batch.update(userRef, {
                    membership: selectedPackage.name,
                    balance: (userData.balance || 0) - selectedPackage.price,
                    lastPackageUpgrade: new Date()
                });

                // 2. Create transaction record
                const transactionId = generateId();
                const transactionRef = db.collection('transactions').doc(transactionId);
                batch.set(transactionRef, {
                    transactionId: transactionId,
                    userId: currentUser.uid,
                    type: 'purchase',
                    amount: selectedPackage.price,
                    date: new Date(),
                    status: 'completed',
                    source: `Package Purchase - ${selectedPackage.name}`,
                    description: `Upgraded to ${selectedPackage.name} package`
                });

                // 3. Create package purchase record
                const purchaseRef = db.collection('package_purchases').doc(generateId());
                batch.set(purchaseRef, {
                    userId: currentUser.uid,
                    packageName: selectedPackage.name,
                    packagePrice: selectedPackage.price,
                    purchaseDate: new Date(),
                    status: 'completed'
                });

                // 4. Create notification
                const notificationRef = db.collection('notifications').doc(generateId());
                batch.set(notificationRef, {
                    userId: currentUser.uid,
                    title: 'Package Upgrade Successful',
                    message: `Congratulations! You have successfully upgraded to ${selectedPackage.name} package.`,
                    type: 'package_upgrade',
                    read: false,
                    createdAt: new Date()
                });

                // Commit the batch
                await batch.commit();

                // Handle referral commissions
                await handleReferralCommissions(selectedPackage.price);

                showToast(`🎉 Successfully upgraded to ${selectedPackage.name} package!`, 'success');
                closeModal();

                // Refresh user data
                setTimeout(() => {
                    loadUserData(currentUser.uid);
                }, 1000);

            } catch (error) {
                console.error('Error purchasing package:', error);
                showToast('Error purchasing package. Please try again.', 'error');
            } finally {
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'Confirm Purchase';
            }
        }

        async function handleReferralCommissions(purchaseAmount) {
            if (!userData?.referredBy) return;

            try {
                // Find sponsor
                const sponsorSnapshot = await db.collection('users')
                    .where('referralCode', '==', userData.referredBy)
                    .get();

                if (sponsorSnapshot.empty) return;

                const sponsorDoc = sponsorSnapshot.docs[0];
                const sponsorData = sponsorDoc.data();
                const sponsorId = sponsorDoc.id;

                const batch = db.batch();

                // Direct commission (50%)
                const directCommission = purchaseAmount * 0.50;
                
                // Update sponsor balance
                const sponsorRef = db.collection('users').doc(sponsorId);
                batch.update(sponsorRef, {
                    balance: (sponsorData.balance || 0) + directCommission,
                    earnings_total: (sponsorData.earnings_total || 0) + directCommission
                });

                // Create commission transaction for sponsor
                const commissionTransactionRef = db.collection('transactions').doc(generateId());
                batch.set(commissionTransactionRef, {
                    transactionId: generateId(),
                    userId: sponsorId,
                    type: 'earning',
                    amount: directCommission,
                    date: new Date(),
                    status: 'completed',
                    source: `Direct Commission - ${userData.name}`,
                    description: `50% commission from ${userData.name}'s package purchase`,
                    category: 'direct'
                });

                // Create notification for sponsor
                const sponsorNotificationRef = db.collection('notifications').doc(generateId());
                batch.set(sponsorNotificationRef, {
                    userId: sponsorId,
                    title: 'Commission Earned!',
                    message: `You earned ₹${directCommission} commission from ${userData.name}'s package purchase.`,
                    type: 'commission',
                    read: false,
                    createdAt: new Date()
                });

                await batch.commit();

            } catch (error) {
                console.error('Error handling referral commissions:', error);
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white font-semibold z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        function loadNotifications(userId) {
            db.collection('notifications')
                .where('userId', '==', userId)
                .where('read', '==', false)
                .onSnapshot((snapshot) => {
                    const unreadCount = snapshot.size;
                    const badge = document.getElementById('notificationBadge');
                    
                    if (unreadCount > 0) {
                        badge.classList.remove('hidden');
                        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                    } else {
                        badge.classList.add('hidden');
                    }
                });
        }

        function updateUserUI(userData) {
            document.getElementById('userName').textContent = userData.name || 'User';
            document.getElementById('headerUserName').textContent = userData.name || 'User';
            document.getElementById('userRank').textContent = userData.rank || 'Affiliate';
            document.getElementById('userBalance').textContent = userData.balance || 0;

            if (userData.profilePic) {
                document.getElementById('userProfilePic').src = userData.profilePic;
                document.getElementById('headerProfilePic').src = userData.profilePic;
            }
        }

        // Utility function to generate IDs
        function generateId() {
            return 'ID_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
    </script>
</body>
                                  </html>
