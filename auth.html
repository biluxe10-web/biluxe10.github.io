<!DOCTYPE html>  <html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Biluxe10 | Login & Signup</title>  
    <script src="https://cdn.tailwindcss.com"></script>  
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">  
    <style>  
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');  
        * {  
            font-family: 'Inter', sans-serif;  
        }  
        .gradient-bg {  
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);  
        }  
        .glass-effect {  
            background: rgba(255, 255, 255, 0.1);  
            backdrop-filter: blur(10px);  
            border: 1px solid rgba(255, 255, 255, 0.2);  
        }  
        .referral-badge {  
            background: linear-gradient(135deg, #F59E0B, #D97706);  
        }  
        .commission-structure {  
            background: rgba(255, 255, 255, 0.15);  
            backdrop-filter: blur(10px);  
        }  
    </style>  
</head>  
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">  
    <!-- Auth Container -->  
    <div class="glass-effect rounded-2xl shadow-2xl p-8 w-full max-w-md">  
        <!-- Logo -->  
        <div class="text-center mb-8">  
            <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">  
                <i class="fas fa-rocket text-2xl text-green-600"></i>  
            </div>  
            <h1 class="text-3xl font-bold text-white">Biluxe10 Affiliate</h1>  
            <p class="text-green-100 mt-2">Premium Earning Platform</p>  
        </div>  <!-- Referral Banner (Shows when referral code is in URL) -->  
    <div id="referralBanner" class="hidden referral-badge text-white p-4 rounded-lg mb-6 text-center">  
        <i class="fas fa-gift text-xl mb-2"></i>  
        <h3 class="font-bold">ðŸŽ‰ Joining with Referral!</h3>  
        <p class="text-sm mt-1">You'll get special welcome bonus of â‚¹100</p>  
        <p class="text-xs mt-1">Referral Code: <strong id="referralCodeDisplay"></strong></p>  
    </div>  

    <!-- Commission Structure -->  
    <div id="commissionInfo" class="commission-structure text-white p-4 rounded-lg mb-6 hidden">  
        <h4 class="font-bold text-center mb-2">ðŸ’° Commission Structure</h4>  
        <div class="text-xs space-y-1">  
            <div class="flex justify-between">  
                <span>Level 1 (Direct):</span>  
                <span class="font-bold">50%</span>  
            </div>  
            <div class="flex justify-between">  
                <span>Level 2 (Team):</span>  
                <span class="font-bold">15%</span>  
            </div>  
            <div class="flex justify-between">  
                <span>Welcome Bonus:</span>  
                <span class="font-bold">â‚¹100</span>  
            </div>  
        </div>  
    </div>  

    <!-- Signup Form -->  
    <div id="signupForm">  
        <h2 class="text-2xl font-bold text-white text-center mb-6">Create Account</h2>  
          
        <div class="space-y-4">  
            <div>  
                <input type="text" id="signupName" placeholder="Full Name"   
                       class="w-full px-4 py-3 rounded-lg bg-white/90 border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">  
            </div>  
              
            <div>  
                <input type="email" id="signupEmail" placeholder="Email Address"   
                       class="w-full px-4 py-3 rounded-lg bg-white/90 border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">  
            </div>  
              
            <div>  
                <input type="password" id="signupPassword" placeholder="Password"   
                       class="w-full px-4 py-3 rounded-lg bg-white/90 border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">  
            </div>  
              
            <div>  
                <input type="tel" id="signupPhone" placeholder="Phone Number"   
                       class="w-full px-4 py-3 rounded-lg bg-white/90 border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">  
            </div>  
              
            <div>  
                <input type="text" id="signupReferral" placeholder="Referral Code (Optional)"   
                       class="w-full px-4 py-3 rounded-lg bg-white/90 border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">  
            </div>  

            <button id="signupBtn"   
                    class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition-all duration-300 shadow-lg">  
                <i class="fas fa-user-plus mr-2"></i>Create Account  
            </button>  
        </div>  

        <p class="text-center text-green-100 mt-6">  
            Already have an account?   
            <button id="showLogin" class="text-white font-semibold hover:underline ml-1">Login</button>  
        </p>  
    </div>  

    <!-- Login Form -->  
    <div id="loginForm" class="hidden">  
        <h2 class="text-2xl font-bold text-white text-center mb-6">Welcome Back</h2>  
          
        <div class="space-y-4">  
            <div>  
                <input type="email" id="loginEmail" placeholder="Email Address"   
                       class="w-full px-4 py-3 rounded-lg bg-white/90 border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">  
            </div>  
              
            <div>  
                <input type="password" id="loginPassword" placeholder="Password"   
                       class="w-full px-4 py-3 rounded-lg bg-white/90 border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">  
            </div>  

            <button id="loginBtn"   
                    class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition-all duration-300 shadow-lg">  
                <i class="fas fa-sign-in-alt mr-2"></i>Login to Dashboard  
            </button>  
        </div>  

        <p class="text-center text-green-100 mt-6">  
            Don't have an account?   
            <button id="showSignup" class="text-white font-semibold hover:underline ml-1">Sign Up</button>  
        </p>  
    </div>  

    <!-- Loading State -->  
    <div id="loadingState" class="hidden text-center py-4">  
        <div class="w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"></div>  
        <p class="text-white text-sm">Processing...</p>  
    </div>  
</div>  

<script type="module">  
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";  
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";  
    import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion, increment, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";  

    const firebaseConfig = {  
        apiKey: "AIzaSyDxxkC9iD1V1w-53Kf4oBrHEXlBLvCc7sE",  
        authDomain: "biluxe10-3e894.firebaseapp.com",  
        projectId: "biluxe10-3e894",  
        storageBucket: "biluxe10-3e894.firebasestorage.app",  
        messagingSenderId: "804749588233",  
        appId: "1:804749588233:web:7777648c0c7834733c05d8"  
    };  

    const app = initializeApp(firebaseConfig);  
    const auth = getAuth(app);  
    const db = getFirestore(app);  

    // DOM Elements  
    const signupForm = document.getElementById('signupForm');  
    const loginForm = document.getElementById('loginForm');  
    const loadingState = document.getElementById('loadingState');  
    const referralBanner = document.getElementById('referralBanner');  
    const commissionInfo = document.getElementById('commissionInfo');  
    const referralCodeDisplay = document.getElementById('referralCodeDisplay');  

    // Check for referral code in URL - AUTO SWITCH TO SIGNUP  
    const urlParams = new URLSearchParams(window.location.search);  
    const referralCodeFromURL = urlParams.get('ref');  
      
    // AUTO SHOW SIGNUP FORM IF REFERRAL LINK  
    if (referralCodeFromURL) {  
        // Hide login form, show signup form  
        loginForm.classList.add('hidden');  
        signupForm.classList.remove('hidden');  
          
        // Show referral banners  
        referralBanner.classList.remove('hidden');  
        commissionInfo.classList.remove('hidden');  
          
        // Auto-fill referral code and display it  
        document.getElementById('signupReferral').value = referralCodeFromURL;  
        referralCodeDisplay.textContent = referralCodeFromURL;  
          
        console.log("ðŸŽ¯ Referral link detected, auto-showing signup form");  
    }  

    // Toggle Forms  
    document.getElementById('showLogin').addEventListener('click', () => {  
        signupForm.classList.add('hidden');  
        loginForm.classList.remove('hidden');  
    });  

    document.getElementById('showSignup').addEventListener('click', () => {  
        loginForm.classList.add('hidden');  
        signupForm.classList.remove('hidden');  
    });  

    // Show Loading  
    function showLoading() {  
        loadingState.classList.remove('hidden');  
        document.getElementById('signupBtn').disabled = true;  
        document.getElementById('loginBtn').disabled = true;  
    }  

    // Hide Loading  
    function hideLoading() {  
        loadingState.classList.add('hidden');  
        document.getElementById('signupBtn').disabled = false;  
        document.getElementById('loginBtn').disabled = false;  
    }  

    // Show Message  
    function showMessage(message, type = 'success') {  
        alert(message);  
    }  

    // Generate Referral Code  
    function generateReferralCode() {  
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';  
        let result = 'BLX10';  
        for (let i = 0; i < 6; i++) {  
            result += chars.charAt(Math.floor(Math.random() * chars.length));  
        }  
        return result;  
    }  

    // Handle Referral System  
    async function handleReferralSystem(newUserId, referralCode, userData) {  
        try {  
            // Find referrer by referral code  
            const usersSnapshot = await getDocs(collection(db, "user_collections"));  
            let referrerId = null;  
            let referrerData = null;  

            usersSnapshot.forEach((doc) => {  
                const user = doc.data();  
                if (user.referralCode === referralCode) {  
                    referrerId = doc.id;  
                    referrerData = user;  
                }  
            });  

            if (referrerId && referrerData) {  
                console.log("ðŸŽ¯ Referral found:", referrerData.email);  

                // Add referredBy to new user  
                userData.referredBy = referrerId;  

                // Create referral relationship  
                await setDoc(doc(db, "referrals", `${referrerId}_${newUserId}`), {  
                    referrerId: referrerId,  
                    referredId: newUserId,  
                    referralCode: referralCode,  
                    joinDate: new Date(),  
                    status: 'active',  
                    level: 1,  
                    earnedCommission: 0  
                });  

                // Update referrer's counts  
                await updateDoc(doc(db, "user_collections", referrerId), {  
                    referralCount: increment(1),  
                    teamCount: increment(1),  
                    activeTeamCount: increment(1),  
                    directCommission: increment(100) // Give bonus to referrer too  
                });  

                // Give welcome bonus to new user  
                await updateDoc(doc(db, "user_collections", newUserId), {  
                    balance: increment(100),  
                    availableBalance: increment(100),  
                    totalEarnings: increment(100),  
                    bonusEarnings: increment(100)  
                });  

                // Record welcome bonus transaction for new user  
                await setDoc(doc(db, "transactions", `${newUserId}_${Date.now()}`), {  
                    userId: newUserId,  
                    type: 'bonus',  
                    amount: 100,  
                    description: 'Welcome bonus for joining with referral',  
                    status: 'completed',  
                    timestamp: new Date()  
                });  

                // Record commission for referrer  
                await setDoc(doc(db, "transactions", `${referrerId}_${Date.now()}`), {  
                    userId: referrerId,  
                    type: 'commission',  
                    amount: 100,  
                    description: `Referral commission from ${userData.username}`,  
                    status: 'completed',  
                    timestamp: new Date()  
                });  

                console.log("âœ… Referral system processed successfully");  
                return true;  
            } else {  
                console.log("âŒ Referral code not found:", referralCode);  
                return false;  
            }  
        } catch (error) {  
            console.error("âŒ Error in referral system:", error);  
            return false;  
        }  
    }  

    // SIGNUP - With Your Exact Fields  
    document.getElementById('signupBtn').addEventListener('click', async () => {  
        const name = document.getElementById('signupName').value.trim();  
        const email = document.getElementById('signupEmail').value.trim();  
        const password = document.getElementById('signupPassword').value.trim();  
        const phone = document.getElementById('signupPhone').value.trim();  
        const referral = document.getElementById('signupReferral').value.trim();  

        if (!name || !email || !password || !phone) {  
            showMessage('Please fill in all fields', 'error');  
            return;  
        }  

        if (password.length < 6) {  
            showMessage('Password must be at least 6 characters', 'error');  
            return;  
        }  

        showLoading();  

        try {  
            // Create user in Firebase Auth  
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);  
            const user = userCredential.user;  

            // Get referral code (from URL or input)  
            const referralCode = referralCodeFromURL || referral;  
            const username = email.split('@')[0];  

            // Create user data with YOUR EXACT FIELDS  
            const userData = {  
                // BASIC INFO  
                userId: user.uid,  
                email: email,  
                username: username,  
                fullName: name,  
                phoneNumber: phone,  
                  
                // CURRENT BALANCES - START WITH 0  
                balance: 0,  
                availableBalance: 0,  
                totalEarnings: 0,  
                  
                // REFERRAL SYSTEM  
                referralCode: generateReferralCode(),  
                referredBy: "", // Will be updated if referral exists  
                referralCount: 0,  
                teamCount: 0,  
                activeTeamCount: 0,  
                  
                // COMMISSION EARNINGS - START WITH 0  
                directCommission: 0,  
                passiveCommission: 0,  
                totalCommission: 0,  
                bonusEarnings: 0,  
                  
                // PACKAGE EARNINGS - START WITH 0  
                packageEarnings: 0,  
                  
                // TIME-BASED EARNINGS - START WITH 0  
                weeklyEarnings: 0,  
                monthlyEarnings: 0,  
                dailyEarnings: 0,  
                  
                // USER STATUS  
                packageLevel: "basic",  
                paymentStatus: "pending", // Payment not done yet  
                joinDate: new Date(),  
                lastLogin: new Date()  
            };  

            // Handle referral system if referral code exists  
            let referralSuccess = false;  
            if (referralCode) {  
                referralSuccess = await handleReferralSystem(user.uid, referralCode, userData);  
                if (referralSuccess) {  
                    userData.balance = 100;  
                    userData.availableBalance = 100;  
                    userData.totalEarnings = 100;  
                    userData.bonusEarnings = 100;  
                }  
            }  

            // Save user data to Firestore - YOUR EXACT COLLECTION  
            await setDoc(doc(db, "user_collections", user.uid), userData);  

            if (referralSuccess) {  
                showMessage('ðŸŽ‰ Account created successfully! You received â‚¹100 welcome bonus! Redirecting to payment page...');  
            } else {  
                showMessage('Account created successfully! Redirecting to payment page...');  
            }  
              
            // REDIRECT TO products.html (Payment Page)  
            setTimeout(() => {  
                window.location.href = 'products.html';  
            }, 2000);  

        } catch (error) {  
            console.error('Signup error:', error);  
            if (error.code === 'auth/email-already-in-use') {  
                showMessage('Email already exists. Please use different email.', 'error');  
            } else if (error.code === 'auth/weak-password') {  
                showMessage('Password should be at least 6 characters', 'error');  
            } else if (error.code === 'auth/invalid-email') {  
                showMessage('Invalid email address', 'error');  
            } else {  
                showMessage('Error creating account: ' + error.message, 'error');  
            }  
        } finally {  
            hideLoading();  
        }  
    });  

    // LOGIN - Check Payment Status  
    document.getElementById('loginBtn').addEventListener('click', async () => {  
        const email = document.getElementById('loginEmail').value.trim();  
        const password = document.getElementById('loginPassword').value.trim();  

        if (!email || !password) {  
            showMessage('Please enter email and password', 'error');  
            return;  
        }  

        showLoading();  

        try {  
            // Login user  
            const userCredential = await signInWithEmailAndPassword(auth, email, password);  
            const user = userCredential.user;  

            // Check user data from YOUR EXACT COLLECTION  
            const userDoc = await getDoc(doc(db, "user_collections", user.uid));  
              
            if (!userDoc.exists()) {  
                showMessage('User data not found! Please sign up first.', 'error');  
                return;  
            }  

            const userData = userDoc.data();  
            const paymentStatus = userData.paymentStatus;  

            // CHECK PAYMENT STATUS - YOUR EXACT FLOW  
            if (paymentStatus === "approved") {  
                showMessage('Login successful! Redirecting to dashboard...');  
                // Update last login  
                await updateDoc(doc(db, "user_collections", user.uid), {  
                    lastLogin: new Date()  
                });  
                // REDIRECT TO dashboard.html  
                setTimeout(() => {  
                    window.location.href = 'dashboard.html';  
                }, 1500);  
            } else {  
                showMessage('Payment not approved yet! Please complete payment first.', 'error');  
                // REDIRECT TO products.html to complete payment  
                setTimeout(() => {  
                    window.location.href = 'products.html';  
                }, 2000);  
            }  

        } catch (error) {  
            console.error('Login error:', error);  
            if (error.code === 'auth/user-not-found') {  
                showMessage('No account found with this email', 'error');  
            } else if (error.code === 'auth/wrong-password') {  
                showMessage('Incorrect password', 'error');  
            } else if (error.code === 'auth/invalid-email') {  
                showMessage('Invalid email address', 'error');  
            } else {  
                showMessage('Login failed: ' + error.message, 'error');  
            }  
        } finally {  
            hideLoading();  
        }  
    });  

    // Enter key support  
    document.addEventListener('keypress', function(event) {  
        if (event.key === 'Enter') {  
            if (!signupForm.classList.contains('hidden')) {  
                document.getElementById('signupBtn').click();  
            } else {  
                document.getElementById('loginBtn').click();  
            }  
        }  
    });  
</script>

</body>  
</html>
