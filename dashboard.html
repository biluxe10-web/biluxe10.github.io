<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biluxe10 Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
body { background: linear-gradient(135deg, #f39c12, #e74c3c); min-height: 100vh; display: flex; }
/* Sidebar */
.sidebar { width: 250px; background: #111; color: #fff; padding: 20px; display: flex; flex-direction: column; }
.sidebar img.logo { width: 150px; margin-bottom: 30px; }
.sidebar a { color: #fff; text-decoration: none; margin: 10px 0; font-weight: 600; cursor: pointer; }
.sidebar a:hover { color: #f39c12; }
.hamburger { display: none; cursor: pointer; font-size: 24px; margin-bottom: 20px; }
/* Main content */
.main { flex: 1; padding: 20px; display: flex; flex-direction: column; }
.topbar { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 30px; }
.topbar img { width: 50px; height: 50px; border-radius: 50%; margin-left: 15px; object-fit: cover; border: 2px solid #fff; }
.cards { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 30px; }
.card { flex: 1 1 200px; background: rgba(255,255,255,0.95); padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
.card h3 { margin-bottom: 10px; color: #e67e22; }
.card p { font-size: 20px; font-weight: 600; }
.section { background: rgba(255,255,255,0.95); padding: 20px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
.section h3 { margin-bottom: 15px; color: #e67e22; }
.referral { display: flex; flex-direction: column; gap: 10px; }
.referral input { padding: 10px; border-radius: 10px; border: 1px solid #ccc; font-size: 14px; }
.share-buttons button { padding: 10px 15px; border-radius: 8px; border: none; cursor: pointer; margin-right: 10px; background: #f39c12; color: #fff; font-weight: 600; }
.share-buttons button:hover { background: #e67e22; }
@media(max-width: 900px) {
  .sidebar { position: fixed; left: -250px; top: 0; height: 100%; transition: 0.3s; z-index: 1000; }
  .sidebar.active { left: 0; }
  .hamburger { display: block; color: #fff; }
  .main { padding: 20px 10px; }
}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <img src="biluxe10.jpg" alt="Biluxe10 Logo" class="logo">
  <a href="dashboard.html">Dashboard</a>
  <a href="profile.html">Profile</a>
  <a href="earning.html">Earnings</a>
  <a href="withdrawal.html">Withdrawal</a>
  <a href="team.html">My Team</a>
  <a href="transition.html">All Transactions</a>
  <a href="ticket.html">Ticket Rise</a>
  <a id="logoutBtn">Log Out</a>
</div>

<!-- Main content -->
<div class="main">
  <div class="hamburger" id="hamburger">&#9776;</div>
  <div class="topbar">
    <span id="username" style="color:white;font-weight:600;"></span>
    <img src="" id="userPic" alt="User Profile">
  </div>

  <!-- Earnings Cards -->
  <div class="cards">
    <div class="card">
      <h3>Today's Earnings</h3>
      <p id="todayEarnings">₹0</p>
    </div>
    <div class="card">
      <h3>Last 7 Days</h3>
      <p id="last7Earnings">₹0</p>
    </div>
    <div class="card">
      <h3>Last 30 Days</h3>
      <p id="last30Earnings">₹0</p>
    </div>
    <div class="card">
      <h3>Lifetime Earnings</h3>
      <p id="lifetimeEarnings">₹0</p>
    </div>
  </div>

  <!-- Commission Section -->
  <div class="section">
    <h3>Commissions</h3>
    <p>Active Commission: ₹<span id="activeCommission">0</span></p>
    <p>Passive Commission: ₹<span id="passiveCommission">0</span></p>
    <p>Ads Bonus: ₹<span id="adsBonus">0</span></p>
  </div>

  <!-- Referral Section -->
  <div class="section referral">
    <h3>Your Referral Link</h3>
    <input type="text" id="referralLink" readonly>
    <div class="share-buttons">
      <button onclick="shareWhatsApp()">WhatsApp</button>
      <button onclick="shareTelegram()">Telegram</button>
      <button onclick="shareFacebook()">Facebook</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getFirestore, collection, query, where, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDxxkC9iD1V1w-53Kf4oBrHEXlBLvCc7sE",
  authDomain: "biluxe10-3e894.firebaseapp.com",
  projectId: "biluxe10-3e894",
  storageBucket: "biluxe10-3e894.firebasestorage.app",
  messagingSenderId: "804749588233",
  appId: "1:804749588233:web:7777648c0c7834733c05d8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const userEmail = localStorage.getItem("userEmail"); 

// Sidebar toggle
const sidebar = document.getElementById("sidebar");
const hamburger = document.getElementById("hamburger");
hamburger.onclick = () => { sidebar.classList.toggle("active"); }

// Logout
document.getElementById("logoutBtn").onclick = () => {
  localStorage.removeItem("userEmail");
  window.location.href = "auth.html";
}

// Share buttons
function shareWhatsApp() { const link = document.getElementById("referralLink").value; window.open(`https://wa.me/?text=Join%20Biluxe10%20with%20my%20referral%20link:%20${link}`, "_blank"); }
function shareTelegram() { const link = document.getElementById("referralLink").value; window.open(`https://t.me/share/url?url=${link}`, "_blank"); }
function shareFacebook() { const link = document.getElementById("referralLink").value; window.open(`https://www.facebook.com/sharer/sharer.php?u=${link}`, "_blank"); }

// Packages
const packages = {
  "1 start success pack": 999,
  "2 advance success pack": 2499,
  "3 digital Empire system": 3499,
  "4 editing mastery": 4999,
  "5 ultimate Drop shipping system": 9999,
  "6 Crypto trading mastery": 15999,
  "7 future AI system": 23999
};

// Load user info and commissions
async function loadUserInfo() {
  const q = query(collection(db, "user_collection"), where("email", "==", userEmail));
  const snapshot = await getDocs(q);
  if (!snapshot.empty) {
    const userData = snapshot.docs[0].data();
    document.getElementById("username").innerText = userData.name;
    document.getElementById("userPic").src = userData.profilepic || "default_user.jpg";
    document.getElementById("referralLink").value = `${window.location.origin}/auth.html?ref=${userData.referralcode}`;

    // Calculate commissions from referrals
    const refSnap = await getDocs(query(collection(db, "referrals"), where("referreduserid", "==", userData.uid)));
    let active = 0, passive = 0, ads = 0;
    refSnap.forEach(doc => {
      const data = doc.data();
      const packagePrice = packages[data.package] || 0;
      active += packagePrice * 0.5;
      passive += packagePrice * 0.1;
      ads += packagePrice * 0.05;
    });
    document.getElementById("activeCommission").innerText = active;
    document.getElementById("passiveCommission").innerText = passive;
    document.getElementById("adsBonus").innerText = ads;

    // Load earnings (simplified example)
    let today = 0, last7 = 0, last30 = 0, lifetime = 0;
    const earningsSnap = await getDocs(query(collection(db, "earnings"), where("uid", "==", userData.uid)));
    const now = new Date();
    earningsSnap.forEach(doc => {
      const data = doc.data();
      const created = data.createdat.toDate();
      lifetime += data.amount || 0;
      if (created.toDateString() === now.toDateString()) today += data.amount || 0;
      const diff = (now - created)/(1000*60*60*24);
      if (diff <= 7) last7 += data.amount || 0;
      if (diff <= 30) last30 += data.amount || 0;
    });
    document.getElementById("todayEarnings").innerText = `₹${today}`;
    document.getElementById("last7Earnings").innerText = `₹${last7}`;
    document.getElementById("last30Earnings").innerText = `₹${last30}`;
    document.getElementById("lifetimeEarnings").innerText = `₹${lifetime}`;
  }
}

loadUserInfo();
</script>
</body>
      </html>
