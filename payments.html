<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Biluxe10 | Payment</title>
  <script src="firebase-init.js"></script>
</head>
<body>
  <h1>Submit Your Payment</h1>

  <input type="text" id="utrNumber" placeholder="Enter UTR / Transaction ID"><br>
  <input type="file" id="paymentProof"><br>
  <button onclick="submitPayment()">Submit Payment</button>

  <script>
    async function submitPayment() {
      const user = auth.currentUser;
      if (!user) {
        alert("Please login first");
        window.location.href = "auth.html";
        return;
      }

      const utr = document.getElementById("utrNumber").value;
      const proofFile = document.getElementById("paymentProof").files[0];

      if (!utr || !proofFile) {
        alert("Please enter UTR and upload proof");
        return;
      }

      try {
        // Upload file to Firebase Storage
        const storageRef = firebase.ref(firebase.getStorage(), 'paymentProofs/' + user.uid + '/' + proofFile.name);
        await firebase.uploadBytes(storageRef, proofFile);
        const proofURL = await firebase.getDownloadURL(storageRef);

        // Update Firestore
        await firebase.updateDoc(firebase.doc(db, "users", user.uid), {
          paymentStatus: "submitted",
          paymentUTR: utr,
          paymentProof: proofURL
        });

        alert("Payment submitted! Waiting for admin verification.");
        window.location.href = "auth.html"; // Redirect back to login after payment
      } catch (error) {
        alert("Error: " + error.message);
      }
    }
  </script>
</body>
</html>
