<!DOCTYPE html>
<html>
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Earnings</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"><style>body{font-family:Poppins;background:#071029;color:#e6eef8;margin:0;padding:20px}.box{max-width:900px;margin:20px auto;background:#0b1220;padding:20px;border-radius:12px} table{width:100%;border-collapse:collapse} th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03)} .muted{color:#98a0b3}</style></head>
<body>
<div class="box">
  <h2>Earnings History</h2>
  <table id="tbl">
    <thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Source</th><th>Status</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
import { auth, db } from './firebase.js';
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
import { collection, query, where, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

const tbody = document.querySelector('#tbl tbody');
onAuthStateChanged(auth, async user=>{
  if(!user){ location.href='auth.html'; return; }
  const uid = user.uid;
  const q = query(collection(db,'earnings'), where('userId','==', uid), orderBy('createdAt','desc'));
  const snap = await getDocs(q);
  tbody.innerHTML = '';
  snap.forEach(d=>{
    const r = d.data();
    const dt = r.createdAt && r.createdAt.toDate ? r.createdAt.toDate().toLocaleString() : (new Date(r.createdAt)).toLocaleString();
    const tr = document.createElement('tr');
    tr.innerHTML = `<td class="muted">${dt}</td><td>${r.type||''}</td><td>â‚¹${Number(r.amount||0).toLocaleString('en-IN')}</td><td>${r.source||''}</td><td>${r.status||''}</td>`;
    tbody.appendChild(tr);
  });
});
</script>
</body>
</html>
