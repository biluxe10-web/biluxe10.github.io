<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biluxe10 - Support</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * {
            font-family: 'Inter', sans-serif;
        }
        .page-transition {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .ticket-card {
            transition: all 0.3s ease;
        }
        .ticket-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .message-user {
            background: #3b82f6;
            color: white;
            border-radius: 18px 18px 4px 18px;
        }
        .message-admin {
            background: #f1f5f9;
            color: #334155;
            border-radius: 18px 18px 18px 4px;
        }
        .chat-container {
            max-height: 400px;
            overflow-y: auto;
        }
        .status-open {
            border-left: 4px solid #f59e0b;
        }
        .status-resolved {
            border-left: 4px solid #10b981;
        }
        .animate-pulse-slow {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation Sidebar -->
    <div class="sidebar fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-gray-900 to-black text-white shadow-xl z-50">
        <!-- Logo -->
        <div class="p-6 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-rocket text-white"></i>
                </div>
                <h1 class="text-xl font-bold">Biluxe10</h1>
            </div>
        </div>

        <!-- User Profile Mini -->
        <div class="p-4 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="relative">
                    <img id="userProfilePic" src="https://via.placeholder.com/40" alt="Profile" class="w-10 h-10 rounded-full border-2 border-blue-500">
                    <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-gray-900"></div>
                </div>
                <div class="flex-1 min-w-0">
                    <p id="userName" class="text-sm font-medium truncate">Loading...</p>
                    <p id="userRank" class="text-xs text-gray-400 truncate">Affiliate</p>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="p-4 space-y-2">
            <a href="dashboard.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-chart-line w-5"></i>
                <span>Dashboard</span>
            </a>
            <a href="earnings.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-money-bill-wave w-5"></i>
                <span>Earnings</span>
            </a>
            <a href="withdrawal.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-wallet w-5"></i>
                <span>Withdrawal</span>
            </a>
            <a href="team.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-users w-5"></i>
                <span>My Team</span>
            </a>
            <a href="referral.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-share-alt w-5"></i>
                <span>Refer & Earn</span>
            </a>
            <a href="packages.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-crown w-5"></i>
                <span>Packages</span>
            </a>
            <a href="profile.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-user-circle w-5"></i>
                <span>Profile</span>
            </a>
            <a href="support.html" class="flex items-center space-x-3 p-3 rounded-lg bg-blue-600 text-white shadow-lg">
                <i class="fas fa-headset w-5"></i>
                <span>Support</span>
            </a>
        </nav>

        <!-- Balance Footer -->
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-800">
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white text-center py-2 rounded-lg font-semibold text-sm">
                Balance: ₹<span id="userBalance">0</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="ml-64 min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between h-16 px-8">
                <div>
                    <h2 class="text-xl font-semibold text-gray-900">Support Center</h2>
                    <p class="text-sm text-gray-600">Get help from our support team</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="p-2 text-gray-600 hover:text-gray-900 relative">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                    </button>
                    <div class="flex items-center space-x-3 bg-gray-50 rounded-lg px-3 py-2">
                        <img id="headerProfilePic" src="https://via.placeholder.com/32" alt="Profile" class="w-8 h-8 rounded-full border-2 border-blue-500">
                        <span id="headerUserName" class="text-sm font-medium text-gray-900">User</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Support Content -->
        <main class="p-6 page-transition">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- New Ticket Form -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Create New Ticket</h3>
                        
                        <form id="ticketForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Subject *
                                </label>
                                <input type="text" id="ticketSubject" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                    placeholder="Brief description of your issue" required>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Category
                                </label>
                                <select id="ticketCategory" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                                    <option value="general">General Support</option>
                                    <option value="technical">Technical Issue</option>
                                    <option value="billing">Billing & Payments</option>
                                    <option value="withdrawal">Withdrawal Issue</option>
                                    <option value="referral">Referral System</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Message *
                                </label>
                                <textarea id="ticketMessage" rows="6"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                    placeholder="Describe your issue in detail..." required></textarea>
                            </div>

                            <button type="submit" id="submitTicketBtn"
                                class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 transition-colors">
                                Submit Ticket
                            </button>
                        </form>

                        <!-- Processing State -->
                        <div id="processingState" class="hidden mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="flex items-center justify-center space-x-3">
                                <div class="w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                                <p class="text-blue-800 font-semibold">Submitting your ticket...</p>
                            </div>
                        </div>

                        <!-- Support Info -->
                        <div class="mt-6 p-4 bg-green-50 rounded-lg border border-green-200">
                            <h4 class="font-semibold text-green-900 mb-2">Support Information</h4>
                            <div class="text-sm text-green-800 space-y-1">
                                <p><strong>Response Time:</strong> 24 hours</p>
                                <p><strong>Email:</strong> support@biluxe10.com</p>
                                <p><strong>Hours:</strong> 9AM - 6PM IST</p>
                                <p><strong>Priority:</strong> Based on package</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tickets List & Chat -->
                <div class="lg:col-span-3">
                    <!-- Tickets Header -->
                    <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-200 mb-6">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Your Support Tickets</h3>
                                <p class="text-sm text-gray-600 mt-1">Track all your support requests</p>
                            </div>
                            
                            <div class="flex items-center space-x-4 text-sm">
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                    <span>Open: <span id="openCount">0</span></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span>Resolved: <span id="resolvedCount">0</span></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-gray-500 rounded-full"></div>
                                    <span>Total: <span id="totalCount">0</span></span>
                                </div>
                            </div>
                        </div>

                        <!-- Tabs -->
                        <div class="flex space-x-1 mt-4">
                            <button id="tabAll" class="tab-btn px-4 py-2 text-sm font-medium rounded-lg bg-blue-600 text-white">
                                All Tickets
                            </button>
                            <button id="tabOpen" class="tab-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100">
                                Open
                            </button>
                            <button id="tabResolved" class="tab-btn px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100">
                                Resolved
                            </button>
                        </div>
                    </div>

                    <!-- Tickets List -->
                    <div id="ticketsList" class="space-y-4">
                        <!-- Tickets will be loaded here automatically -->
                        <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-gray-200">
                            <div class="text-6xl text-gray-300 mb-4">
                                <i class="fas fa-headset"></i>
                            </div>
                            <p class="text-gray-500 text-lg">Loading your support tickets...</p>
                        </div>
                    </div>

                    <!-- Selected Ticket Chat -->
                    <div id="ticketChat" class="hidden mt-6 bg-white rounded-2xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900" id="chatTicketSubject">Ticket Subject</h4>
                                    <p class="text-sm text-gray-600">Ticket ID: <span id="chatTicketId" class="font-mono"></span></p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <span id="chatTicketStatus" class="px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                        Open
                                    </span>
                                    <button onclick="closeChat()" class="p-2 text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Messages -->
                        <div class="p-6 chat-container" id="chatMessages">
                            <!-- Messages will be loaded here -->
                        </div>

                        <!-- Reply Area (Only for open tickets) -->
                        <div id="replyArea" class="p-4 border-t border-gray-200 hidden">
                            <div class="flex space-x-3">
                                <input type="text" id="replyMessage" 
                                    class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Type your reply...">
                                <button onclick="sendReply()" 
                                    class="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                                    Send
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">
                                Your reply will be sent to our support team for review.
                            </p>
                        </div>

                        <!-- Closed Ticket Message -->
                        <div id="closedTicketMessage" class="p-6 bg-gray-50 text-center hidden">
                            <i class="fas fa-lock text-gray-400 text-2xl mb-2"></i>
                            <p class="text-gray-600">This ticket has been resolved and is closed for new replies.</p>
                            <p class="text-sm text-gray-500 mt-1">Create a new ticket if you need further assistance.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase & Support Script -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDxxkC9iD1V1w-53Kf4oBrHEXlBLvCc7sE",
            authDomain: "biluxe10-3e894.firebaseapp.com",
            projectId: "biluxe10-3e894",
            storageBucket: "biluxe10-3e894.firebasestorage.app",
            messagingSenderId: "804749588233",
            appId: "1:804749588233:web:7777648c0c7834733c05d8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let currentUser = null;
        let userData = null;
        let tickets = [];
        let currentTicket = null;
        let currentFilter = 'all';

        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
            setupTabs();
            setupForm();
        });

        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loadUserData(user.uid);
                    loadTickets(user.uid);
                } else {
                    window.location.href = 'auth.html';
                }
            });
        }

        function loadUserData(userId) {
            db.collection('users').doc(userId).onSnapshot((doc) => {
                if (doc.exists) {
                    userData = doc.data();
                    updateUserUI(userData);
                }
            });
        }

        function loadTickets(userId) {
            db.collection('support_tickets')
                .where('userId', '==', userId)
                .orderBy('createdAt', 'desc')
                .onSnapshot((snapshot) => {
                    tickets = [];
                    snapshot.forEach((doc) => {
                        tickets.push({ id: doc.id, ...doc.data() });
                    });
                    updateTicketsUI();
                    updateStats();
                });
        }

        function setupTabs() {
            const tabs = ['tabAll', 'tabOpen', 'tabResolved'];
            tabs.forEach(tabId => {
                document.getElementById(tabId).addEventListener('click', function() {
                    // Update active tab
                    tabs.forEach(t => {
                        document.getElementById(t).classList.remove('bg-blue-600', 'text-white');
                        document.getElementById(t).classList.add('text-gray-600', 'hover:text-gray-900', 'hover:bg-gray-100');
                    });
                    this.classList.remove('text-gray-600', 'hover:text-gray-900', 'hover:bg-gray-100');
                    this.classList.add('bg-blue-600', 'text-white');

                    // Update filter
                    currentFilter = tabId.replace('tab', '').toLowerCase();
                    updateTicketsUI();
                });
            });
        }

        function setupForm() {
            document.getElementById('ticketForm').addEventListener('submit', handleTicketSubmit);
        }

        async function handleTicketSubmit(e) {
            e.preventDefault();

            const subject = document.getElementById('ticketSubject').value.trim();
            const category = document.getElementById('ticketCategory').value;
            const message = document.getElementById('ticketMessage').value.trim();

            if (!subject || !message) {
                alert('Please fill all required fields');
                return;
            }

            const submitBtn = document.getElementById('submitTicketBtn');
            const processingState = document.getElementById('processingState');

            submitBtn.disabled = true;
            processingState.classList.remove('hidden');

            try {
                // Create ticket in Firestore
                await db.collection('support_tickets').add({
                    ticketId: `TKT_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                    userId: currentUser.uid,
                    subject: subject,
                    category: category,
                    message: message,
                    status: 'open',
                    reply: '',
                    createdAt: new Date(),
                    updatedAt: new Date()
                });

                // Reset form
                document.getElementById('ticketForm').reset();
                alert('Ticket submitted successfully! Our team will respond within 24 hours.');

            } catch (error) {
                console.error('Error submitting ticket:', error);
                alert('Error submitting ticket. Please try again.');
            } finally {
                submitBtn.disabled = false;
                processingState.classList.add('hidden');
            }
        }

        function updateTicketsUI() {
            const container = document.getElementById('ticketsList');
            const filteredTickets = tickets.filter(ticket => {
                if (currentFilter === 'all') return true;
                return ticket.status === currentFilter;
            });

            if (filteredTickets.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-gray-200">
                        <div class="text-6xl text-gray-300 mb-4">
                            <i class="fas fa-headset"></i>
                        </div>
                        <p class="text-gray-500 text-lg">
                            ${currentFilter === 'all' ? 'No support tickets yet' : 
                              currentFilter === 'open' ? 'No open tickets' : 
                              'No resolved tickets'}
                        </p>
                        <p class="text-sm text-gray-400 mt-1">
                            ${currentFilter === 'all' ? 'Create your first support ticket to get help' : 
                              'All your issues have been resolved!'}
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredTickets.map(ticket => `
                <div class="ticket-card bg-white rounded-xl shadow-sm p-6 border-l-4 status-${ticket.status} cursor-pointer" 
                     onclick="openTicket('${ticket.id}')">
                    <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h4 class="font-semibold text-gray-900">${ticket.subject}</h4>
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                                    ticket.status === 'open' 
                                        ? 'bg-yellow-100 text-yellow-800' 
                                        : 'bg-green-100 text-green-800'
                                }">
                                    ${ticket.status}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${ticket.message.substring(0, 100)}${ticket.message.length > 100 ? '...' : ''}</p>
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>Category: ${ticket.category}</span>
                                <span>Created: ${ticket.createdAt?.toDate ? ticket.createdAt.toDate().toLocaleDateString() : 'Recent'}</span>
                                <span class="font-mono">${ticket.ticketId}</span>
                            </div>
                        </div>
                        
                        <div class="text-right">
                            <div class="text-2xl mb-2">
                                ${ticket.status === 'open' ? '⏳' : '✅'}
                            </div>
                            <p class="text-sm text-gray-600">
                                ${ticket.updatedAt ? 'Updated: ' + ticket.updatedAt.toDate().toLocaleDateString() : ''}
                            </p>
                        </div>
                    </div>

                    ${ticket.reply ? `
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <p class="text-sm font-medium text-blue-900 mb-1">Admin Reply:</p>
                            <p class="text-sm text-blue-800">${ticket.reply.substring(0, 150)}${ticket.reply.length > 150 ? '...' : ''}</p>
                        </div>
                    ` : `
                        <div class="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                            <p class="text-sm text-yellow-800">
                                <i class="fas fa-clock mr-1"></i>Waiting for admin response
                            </p>
                        </div>
                    `}
                </div>
            `).join('');
        }

        function openTicket(ticketId) {
            currentTicket = tickets.find(t => t.id === ticketId);
            if (!currentTicket) return;

            // Update chat header
            document.getElementById('chatTicketSubject').textContent = currentTicket.subject;
            document.getElementById('chatTicketId').textContent = currentTicket.ticketId;
            
            // Update status badge
            const statusBadge = document.getElementById('chatTicketStatus');
            statusBadge.textContent = currentTicket.status;
            statusBadge.className = `px-3 py-1 text-xs font-semibold rounded-full ${
                currentTicket.status === 'open' 
                    ? 'bg-yellow-100 text-yellow-800' 
                    : 'bg-green-100 text-green-800'
            }`;

            // Load chat messages
            loadChatMessages();

            // Show/hide reply area
            if (currentTicket.status === 'open') {
                document.getElementById('replyArea').classList.remove('hidden');
                document.getElementById('closedTicketMessage').classList.add('hidden');
            } else {
                document.getElementById('replyArea').classList.add('hidden');
                document.getElementById('closedTicketMessage').classList.remove('hidden');
            }

            // Show chat
            document.getElementById('ticketChat').classList.remove('hidden');
        }

        function loadChatMessages() {
            const chatContainer = document.getElementById('chatMessages');
            
            let messagesHTML = `
                <!-- User's original message -->
                <div class="flex justify-end mb-4">
                    <div class="message-user max-w-xs lg:max-w-md px-4 py-2">
                        <p class="text-sm">${currentTicket.message}</p>
                        <p class="text-xs opacity-75 mt-1 text-right">
                            ${currentTicket.createdAt?.toDate ? currentTicket.createdAt.toDate().toLocaleString() : 'You'}
                        </p>
                    </div>
                </div>
            `;

            // Admin reply
            if (currentTicket.reply) {
                messagesHTML += `
                    <div class="flex justify-start mb-4">
                        <div class="message-admin max-w-xs lg:max-w-md px-4 py-2">
                            <p class="text-sm font-medium text-gray-900 mb-1">Support Team</p>
                            <p class="text-sm">${currentTicket.reply}</p>
                            <p class="text-xs text-gray-500 mt-1">
                                ${currentTicket.updatedAt?.toDate ? currentTicket.updatedAt.toDate().toLocaleString() : 'Admin'}
                            </p>
                        </div>
                    </div>
                `;
            }

            chatContainer.innerHTML = messagesHTML;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendReply() {
            const replyMessage = document.getElementById('replyMessage').value.trim();
            if (!replyMessage || !currentTicket) return;

            try {
                // In a real implementation, you would send this to your backend
                // For now, we'll just show a message
                alert('Your reply has been sent to our support team. They will respond soon.');
                
                document.getElementById('replyMessage').value = '';
                
                // You could also update the ticket with the user's reply
                // await db.collection('support_tickets').doc(currentTicket.id).update({
                //     userReply: replyMessage,
                //     updatedAt: new Date()
                // });

            } catch (error) {
                console.error('Error sending reply:', error);
                alert('Error sending reply. Please try again.');
            }
        }

        function closeChat() {
            document.getElementById('ticketChat').classList.add('hidden');
            currentTicket = null;
        }

        function updateStats() {
            const openCount = tickets.filter(t => t.status === 'open').length;
            const resolvedCount = tickets.filter(t => t.status === 'resolved').length;
            const totalCount = tickets.length;

            document.getElementById('openCount').textContent = openCount;
            document.getElementById('resolvedCount').textContent = resolvedCount;
            document.getElementById('totalCount').textContent = totalCount;
        }

        function updateUserUI(userData) {
            document.getElementById('userName').textContent = userData.name || 'User';
            document.getElementById('headerUserName').textContent = userData.name || 'User';
            document.getElementById('userRank').textContent = userData.rank || 'Affiliate';
            document.getElementById('userBalance').textContent = userData.balance || 0;

            if (userData.profilePic) {
                document.getElementById('userProfilePic').src = userData.profilePic;
                document.getElementById('headerProfilePic').src = userData.profilePic;
            }
        }
    </script>
</body>
                          </html>
