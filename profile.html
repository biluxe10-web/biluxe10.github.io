<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biluxe10 - Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-storage.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * {
            font-family: 'Inter', sans-serif;
        }
        .page-transition {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .profile-pic {
            transition: all 0.3s ease;
        }
        .profile-pic:hover {
            transform: scale(1.05);
        }
        .upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .upload-area.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .status-badge {
            transition: all 0.3s ease;
        }
        .status-badge:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation Sidebar -->
    <div class="sidebar fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-gray-900 to-black text-white shadow-xl z-50">
        <!-- Logo -->
        <div class="p-6 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-rocket text-white"></i>
                </div>
                <h1 class="text-xl font-bold">Biluxe10</h1>
            </div>
        </div>

        <!-- User Profile Mini -->
        <div class="p-4 border-b border-gray-800">
            <div class="flex items-center space-x-3">
                <div class="relative">
                    <img id="userProfilePic" src="https://via.placeholder.com/40" alt="Profile" class="w-10 h-10 rounded-full border-2 border-blue-500">
                    <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-gray-900"></div>
                </div>
                <div class="flex-1 min-w-0">
                    <p id="userName" class="text-sm font-medium truncate">Loading...</p>
                    <p id="userRank" class="text-xs text-gray-400 truncate">Affiliate</p>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="p-4 space-y-2">
            <a href="dashboard.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-chart-line w-5"></i>
                <span>Dashboard</span>
            </a>
            <a href="earnings.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-money-bill-wave w-5"></i>
                <span>Earnings</span>
            </a>
            <a href="withdrawal.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-wallet w-5"></i>
                <span>Withdrawal</span>
            </a>
            <a href="team.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-users w-5"></i>
                <span>My Team</span>
            </a>
            <a href="referral.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-share-alt w-5"></i>
                <span>Refer & Earn</span>
            </a>
            <a href="packages.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-crown w-5"></i>
                <span>Packages</span>
            </a>
            <a href="profile.html" class="flex items-center space-x-3 p-3 rounded-lg bg-blue-600 text-white shadow-lg">
                <i class="fas fa-user-circle w-5"></i>
                <span>Profile</span>
            </a>
            <a href="support.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition duration-300">
                <i class="fas fa-headset w-5"></i>
                <span>Support</span>
            </a>
        </nav>

        <!-- Balance Footer -->
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-800">
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white text-center py-2 rounded-lg font-semibold text-sm">
                Balance: ₹<span id="userBalance">0</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="ml-64 min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between h-16 px-8">
                <div>
                    <h2 class="text-xl font-semibold text-gray-900">Profile Settings</h2>
                    <p class="text-sm text-gray-600">Manage your account information</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="p-2 text-gray-600 hover:text-gray-900 relative">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                    </button>
                    <div class="flex items-center space-x-3 bg-gray-50 rounded-lg px-3 py-2">
                        <img id="headerProfilePic" src="https://via.placeholder.com/32" alt="Profile" class="w-8 h-8 rounded-full border-2 border-blue-500">
                        <span id="headerUserName" class="text-sm font-medium text-gray-900">User</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Profile Content -->
        <main class="p-6 page-transition">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Profile Picture & Status -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Profile Picture</h3>
                        
                        <!-- Profile Picture -->
                        <div class="flex flex-col items-center space-y-4 mb-6">
                            <div class="relative">
                                <img id="mainProfilePic" src="https://via.placeholder.com/120" alt="Profile" 
                                    class="profile-pic w-32 h-32 rounded-full border-4 border-blue-500 shadow-lg object-cover">
                                <div id="uploadingOverlay" class="hidden absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center">
                                    <div class="w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
                                </div>
                            </div>

                            <!-- Upload Area -->
                            <div class="upload-area w-full p-4 rounded-lg text-center cursor-pointer" id="uploadArea">
                                <input type="file" id="profileImageInput" accept="image/*" class="hidden">
                                <i class="fas fa-camera text-2xl text-gray-400 mb-2"></i>
                                <p class="text-sm text-gray-600">Click to upload or drag & drop</p>
                                <p class="text-xs text-gray-500 mt-1">JPG, PNG, GIF • Max 5MB</p>
                            </div>

                            <button id="uploadBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 transition duration-300 disabled:opacity-50">
                                <i class="fas fa-upload mr-2"></i>Upload Photo
                            </button>
                        </div>

                        <!-- Account Status -->
                        <div class="space-y-4">
                            <h4 class="font-semibold text-gray-900">Account Status</h4>
                            
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-sm text-gray-600">Membership:</span>
                                <span id="membershipStatus" class="status-badge px-3 py-1 bg-yellow-100 text-yellow-800 text-xs font-semibold rounded-full">
                                    Loading...
                                </span>
                            </div>

                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-sm text-gray-600">KYC Status:</span>
                                <span id="kycStatus" class="status-badge px-3 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded-full">
                                    Loading...
                                </span>
                            </div>

                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-sm text-gray-600">Rank:</span>
                                <span id="rankStatus" class="status-badge px-3 py-1 bg-purple-100 text-purple-800 text-xs font-semibold rounded-full">
                                    Loading...
                                </span>
                            </div>

                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-sm text-gray-600">Referral Code:</span>
                                <span id="referralCode" class="status-badge px-3 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full font-mono">
                                    Loading...
                                </span>
                            </div>

                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-sm text-gray-600">Join Date:</span>
                                <span id="joinDate" class="text-sm text-gray-900">Loading...</span>
                            </div>

                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-sm text-gray-600">Last Login:</span>
                                <span id="lastLogin" class="text-sm text-gray-900">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Form -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow-sm p-6 border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6">Personal Information</h3>

                        <form id="profileForm" class="space-y-6">
                            <!-- Basic Information -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Full Name *
                                    </label>
                                    <input type="text" id="fullName" name="name"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                        required>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Email Address
                                    </label>
                                    <input type="email" id="email" 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed"
                                        disabled>
                                    <p class="text-xs text-gray-500 mt-1">Email cannot be changed</p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Phone Number
                                    </label>
                                    <input type="tel" id="phone" name="phone"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                        placeholder="+91 XXXXXXXXXX">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Referred By
                                    </label>
                                    <input type="text" id="referredBy"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed"
                                        disabled>
                                </div>
                            </div>

                            <!-- Bank & Payment Details -->
                            <div class="border-t border-gray-200 pt-6">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4">Bank & Payment Details</h4>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            Bank Account Number
                                        </label>
                                        <input type="text" id="bankAccount" name="bankAccount"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            placeholder="Enter account number">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            IFSC Code
                                        </label>
                                        <input type="text" id="ifscCode" name="ifsc"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            placeholder="Enter IFSC code">
                                    </div>

                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            UPI ID
                                        </label>
                                        <input type="text" id="upiId" name="upi"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            placeholder="yourname@upi">
                                        <p class="text-xs text-gray-500 mt-1">
                                            For instant UPI payments and withdrawals
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Save Button -->
                            <div class="flex space-x-4 pt-6">
                                <button type="submit" id="saveBtn"
                                    class="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold text-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300">
                                    <i class="fas fa-save mr-2"></i>Save Changes
                                </button>
                                <button type="button" onclick="window.location.href='dashboard.html'"
                                    class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors">
                                    Cancel
                                </button>
                            </div>

                            <!-- Saving State -->
                            <div id="savingState" class="hidden p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="flex items-center justify-center space-x-3">
                                    <div class="w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                                    <p class="text-blue-800 font-semibold">Saving your changes...</p>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Security Note -->
                    <div class="mt-6 bg-green-50 border border-green-200 rounded-2xl p-6">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-shield-alt text-green-600 text-xl mt-1"></i>
                            <div>
                                <h4 class="font-semibold text-green-800 mb-2">Security Information</h4>
                                <p class="text-sm text-green-700">
                                    Your personal information is securely encrypted and protected. 
                                    We never share your bank details with third parties.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase & Profile Script -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDxxkC9iD1V1w-53Kf4oBrHEXlBLvCc7sE",
            authDomain: "biluxe10-3e894.firebaseapp.com",
            projectId: "biluxe10-3e894",
            storageBucket: "biluxe10-3e894.firebasestorage.app",
            messagingSenderId: "804749588233",
            appId: "1:804749588233:web:7777648c0c7834733c05d8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();

        let currentUser = null;
        let userData = null;
        let selectedFile = null;

        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
            setupUpload();
            setupForm();
        });

        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loadUserData(user.uid);
                } else {
                    window.location.href = 'auth.html';
                }
            });
        }

        function loadUserData(userId) {
            db.collection('users').doc(userId).onSnapshot((doc) => {
                if (doc.exists) {
                    userData = doc.data();
                    updateProfileUI(userData);
                }
            });
        }

        function setupUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('profileImageInput');
            const uploadBtn = document.getElementById('uploadBtn');

            // Click to select file
            uploadArea.addEventListener('click', () => fileInput.click());
            
            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handleFileSelect(e.target.files[0]);
                }
            });

            // Upload button
            uploadBtn.addEventListener('click', uploadProfilePicture);
        }

        function handleFileSelect(file) {
            // Validate file
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                alert('File size must be less than 5MB');
                return;
            }

            selectedFile = file;
            
            // Show preview
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('mainProfilePic').src = e.target.result;
            };
            reader.readAsDataURL(file);

            // Enable upload button
            document.getElementById('uploadBtn').disabled = false;
        }

        async function uploadProfilePicture() {
            if (!selectedFile) {
                alert('Please select a file first');
                return;
            }

            const uploadBtn = document.getElementById('uploadBtn');
            const uploadingOverlay = document.getElementById('uploadingOverlay');

            uploadBtn.disabled = true;
            uploadingOverlay.classList.remove('hidden');

            try {
                // Upload to Firebase Storage
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`profile-pictures/${currentUser.uid}`);
                const snapshot = await fileRef.put(selectedFile);
                const downloadURL = await snapshot.ref.getDownloadURL();

                // Update user profile in Firestore
                await db.collection('users').doc(currentUser.uid).update({
                    profilePic: downloadURL
                });

                alert('Profile picture updated successfully!');
                selectedFile = null;
                document.getElementById('profileImageInput').value = '';

            } catch (error) {
                console.error('Error uploading image:', error);
                alert('Error uploading profile picture. Please try again.');
            } finally {
                uploadBtn.disabled = true;
                uploadingOverlay.classList.add('hidden');
            }
        }

        function setupForm() {
            const form = document.getElementById('profileForm');
            form.addEventListener('submit', handleProfileUpdate);
        }

        async function handleProfileUpdate(e) {
            e.preventDefault();

            const saveBtn = document.getElementById('saveBtn');
            const savingState = document.getElementById('savingState');

            saveBtn.disabled = true;
            savingState.classList.remove('hidden');

            try {
                const formData = {
                    name: document.getElementById('fullName').value,
                    phone: document.getElementById('phone').value,
                    bankAccount: document.getElementById('bankAccount').value,
                    ifsc: document.getElementById('ifscCode').value,
                    upi: document.getElementById('upiId').value
                };

                // Update user data in Firestore
                await db.collection('users').doc(currentUser.uid).update(formData);

                savingState.innerHTML = `
                    <div class="flex items-center justify-center space-x-3">
                        <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        <p class="text-green-800 font-semibold">Changes saved successfully!</p>
                    </div>
                `;

                setTimeout(() => {
                    savingState.classList.add('hidden');
                    savingState.innerHTML = `
                        <div class="flex items-center justify-center space-x-3">
                            <div class="w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                            <p class="text-blue-800 font-semibold">Saving your changes...</p>
                        </div>
                    `;
                }, 2000);

            } catch (error) {
                console.error('Error updating profile:', error);
                alert('Error updating profile. Please try again.');
            } finally {
                saveBtn.disabled = false;
                setTimeout(() => savingState.classList.add('hidden'), 2000);
            }
        }

        function updateProfileUI(userData) {
            // Update form fields
            document.getElementById('fullName').value = userData.name || '';
            document.getElementById('email').value = userData.email || '';
            document.getElementById('phone').value = userData.phone || '';
            document.getElementById('bankAccount').value = userData.bankAccount || '';
            document.getElementById('ifscCode').value = userData.ifsc || '';
            document.getElementById('upiId').value = userData.upi || '';
            document.getElementById('referredBy').value = userData.referredBy || 'No one';

            // Update profile pictures
            if (userData.profilePic) {
                document.getElementById('mainProfilePic').src = userData.profilePic;
                document.getElementById('userProfilePic').src = userData.profilePic;
                document.getElementById('headerProfilePic').src = userData.profilePic;
            }

            // Update status badges
            document.getElementById('membershipStatus').textContent = userData.membership || 'Silver';
            document.getElementById('kycStatus').textContent = userData.kycStatus || 'pending';
            document.getElementById('rankStatus').textContent = userData.rank || 'Affiliate';
            document.getElementById('referralCode').textContent = userData.referralCode || 'N/A';
            document.getElementById('joinDate').textContent = userData.joinDate?.toDate ? userData.joinDate.toDate().toLocaleDateString() : 'N/A';
            document.getElementById('lastLogin').textContent = userData.lastLogin?.toDate ? userData.lastLogin.toDate().toLocaleDateString() : 'N/A';

            // Update KYC status color
            const kycBadge = document.getElementById('kycStatus');
            if (userData.kycStatus === 'verified') {
                kycBadge.className = 'status-badge px-3 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full';
            }

            // Update sidebar
            document.getElementById('userName').textContent = userData.name || 'User';
            document.getElementById('headerUserName').textContent = userData.name || 'User';
            document.getElementById('userRank').textContent = userData.rank || 'Affiliate';
            document.getElementById('userBalance').textContent = userData.balance || 0;
        }
    </script>
</body>
                              </html>
